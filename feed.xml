<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.3">Jekyll</generator><link href="https://ordina-jworks.github.io/feed.xml" rel="self" type="application/atom+xml" /><link href="https://ordina-jworks.github.io/" rel="alternate" type="text/html" /><updated>2018-03-22T10:54:18+00:00</updated><id>https://ordina-jworks.github.io/</id><title type="html">Ordina JWorks Tech Blog</title><subtitle>We build innovative solutions with Java and JavaScript. To support this mission, we have several Competence Centers. From within those Competence Centers, we provide coaching to the employee and expert advice towards our customer. In order to keep in sync with the latest technologies and the latest trends, we frequently visit conferences around the globe.
</subtitle><entry><title type="html">SecAppDev 2018</title><link href="https://ordina-jworks.github.io/conference/2018/03/15/SecAppDev-2018.html" rel="alternate" type="text/html" title="SecAppDev 2018" /><published>2018-03-15T00:00:00+00:00</published><updated>2018-03-15T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/conference/2018/03/15/secappdev</id><content type="html" xml:base="https://ordina-jworks.github.io/conference/2018/03/15/SecAppDev-2018.html">&lt;blockquote&gt;
  &lt;p&gt;Last February I was able to attend the 2018 edition of &lt;a href=&quot;https://www.secappdev.org/&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;SecAppDev&lt;/a&gt;.
It’s a training/security conference in Leuven that lasts a week and which hosts top-notch speakers.
It’s organised by Philippe De Ryck of imec-DistriNet, KU Leuven.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;SecAppDev for me was a week filled with learning, I’ll recap a few of the sessions I attended in this post.&lt;/p&gt;

&lt;h1 id=&quot;security-model-of-the-web---philippe-de-ryck&quot;&gt;Security model of the web - Philippe De Ryck&lt;/h1&gt;
&lt;p&gt;The most basic security control of the modern internet is the ‘Origin’.
This was thought up over 20 years ago and, at the time, was adequate for its purpose.
Nowadays however, origin is a poor security constraint: we load scripts from CDNs, we include frames from other providers, …
Because of this, more security controls have been bolted on in the last years.
In this talk, Philippe De Ryck explored some of these.
We learned how to use &lt;code class=&quot;highlighter-rouge&quot;&gt;X-Frame-Options&lt;/code&gt; and Content Security Policy (CSP) settings to limit who can include our pages in a frame.
Next up he explained how to limit the power of other sites which you might need to frame in yours using the &lt;code class=&quot;highlighter-rouge&quot;&gt;sandbox&lt;/code&gt; attribute, which was introduced in HTML5.
Once you’ve limited what the frame can do, you can open up communications between your page and the frame through the Web Messaging API.&lt;/p&gt;

&lt;p&gt;Once you’re past frames, we come to scripts.
Nowadays, we load scripts from all over the place, often knowing nothing more than a name.
These scripts run within the context of your page and can do everything the current user can do.
To make sure these scripts aren’t tampered with you’d ideally investigate them first and then use subresource integrity (SRI) to make sure they aren’t modified.
Most CDNs nowadays offer this as a service: they provide you with the correct hashes for the scripts they host.
That does mean you need to trust your CDN to host a non-malicious file at the time you include it.&lt;/p&gt;

&lt;p&gt;After a quick look at CSP, we came to the cookies.
As we all know, cookies are not the best solution: they’re sent over both HTTP and HTTPS and they can be read and modified by (malicious) scripts.
This allows for some interesting attacks like session hijacking and session fixation.
An attempt was made to fix this through &lt;code class=&quot;highlighter-rouge&quot;&gt;Secure&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;HttpOnly&lt;/code&gt; flags.
Recently a new spec tries to restrict cookie behavior based on prefixes: &lt;code class=&quot;highlighter-rouge&quot;&gt;__Secure-&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;__Host-&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Because browsers send your cookies on all requests to your domains, this opens you up to an attack called Cross Site Request Forgery (CSRF).
We discussed a few methods that can be used to mitigate this risk: hidden form tokens, “transparent” tokens, checking the origin header and samesite cookies.&lt;/p&gt;

&lt;p&gt;The session ended with a look at JSON Web Tokens (JWT).
Contrary to popular belief, these represent data, &lt;strong&gt;not&lt;/strong&gt; a transport mechanism.
It’s perfectly fine to store a JWT in a cookie, rendering the whole cookie vs. tokens debate a bit useless.
Putting your token on an &lt;code class=&quot;highlighter-rouge&quot;&gt;Authorization&lt;/code&gt; header, does protect against CSRF, but introduces some other complexities.&lt;/p&gt;

&lt;h1 id=&quot;owasps-top-10-proactive-controls-jim-manico&quot;&gt;OWASP’s top 10 proactive controls (Jim Manico)&lt;/h1&gt;
&lt;p&gt;In this session we had a quick look at version 2 of the OWASP &lt;a href=&quot;https://www.owasp.org/index.php/OWASP_Proactive_Controls&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;proactive controls&lt;/a&gt;.
These are the things every developer should do in order to harden their code.
The full list has 10 items, but because of some very interesting discussions, we only managed to cover the first 5.&lt;/p&gt;

&lt;h2 id=&quot;1-verify-for-security-early-and-often&quot;&gt;1. Verify for security early and often&lt;/h2&gt;
&lt;p&gt;This is not an easy thing in today’s DevOps world as code is deployed to production a lot more often.
Etsy deploys more than 25 times per day, while Amazon manages a deploy every 11.6 &lt;em&gt;seconds&lt;/em&gt;!
Make sure that security testing is part of the build process, doing that ensures that your security testing actually happens.
There are several tools available that can help you out here (e.g. OWASP ZAP or Nessus) and you can combine them for increased coverage.
Make sure you don’t end up on the “hamster wheel of pain” where you focus on the specific bugs they reveal, rather than the &lt;em&gt;class&lt;/em&gt; of bugs.&lt;/p&gt;

&lt;h2 id=&quot;2-parameterize-queries&quot;&gt;2. Parameterize queries&lt;/h2&gt;
&lt;p&gt;We should all know by now that queries should &lt;strong&gt;never&lt;/strong&gt; be built using string concatenations.
Use parameterized queries instead to prevent SQL injections.
Use parameters for &lt;em&gt;everything&lt;/em&gt;: not just the user-supplied input, but configurations and hard-coded values as well.
This can give you a performance boost as well, since parameterized queries are compiled by the database only once and then reused.&lt;/p&gt;

&lt;h2 id=&quot;3-encode-data-before-use-in-a-parser&quot;&gt;3. Encode data before use in a parser&lt;/h2&gt;
&lt;p&gt;The best known vulnerability here is Cross Site Scripting (XSS).
Allowing someone to inject HTML tags in your HTML pages gives them nearly unlimited power over your application.
Make sure to encode all user input before feeding it to a parser (a browser is basically a very powerful HTML parser) to prevent these kinds of issues.
For Java applications, you can use the &lt;a href=&quot;https://www.owasp.org/index.php/OWASP_Java_Encoder_Project&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OWASP Java encoder project&lt;/a&gt; to handle your HTML encoding.
They also have tools available for other languages (.NET, PHP, …).&lt;/p&gt;

&lt;h2 id=&quot;4-validate-all-inputs&quot;&gt;4. Validate all inputs&lt;/h2&gt;
&lt;p&gt;And don’t just do it client-side.
Client-side validations are easily bypassed, so you need to repeat them server-side as well.
If your users need to be able to post HTML, you need to sanitize it.
For that you can use the &lt;a href=&quot;https://www.owasp.org/index.php/OWASP_Java_HTML_Sanitizer_Project&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OWASP HTML Sanitizer&lt;/a&gt;.
Keep in mind that even valid data can cause issues: &lt;code class=&quot;highlighter-rouge&quot;&gt;' OR '1'='1'; --&lt;/code&gt; is a perfectly valid password, and the Irish people will be grateful that you allow the use of &lt;code class=&quot;highlighter-rouge&quot;&gt;'&lt;/code&gt; in name fields.&lt;/p&gt;

&lt;h3 id=&quot;what-about-files&quot;&gt;What about files?&lt;/h3&gt;
&lt;p&gt;You also need to do this if your users are allowed to upload files.
Files create even more risks: you need to make sure that the uploaded files are safe.
First validate the file name, file type and decompressed size (preferably &lt;em&gt;before&lt;/em&gt; decompressing).
Run it through a virus scanner on a separate machine to protect against exploits against your antivirus.
For images, you need to enforce size limits and you’ll want to verify that you’re actually dealing with an image.
The easiest way to do that is to rewrite the image (e.g. using ImageMagick).
Once again, you want to do this on a separate machine to prevent malicious images to take over your application.&lt;/p&gt;

&lt;h2 id=&quot;5-establish-authentication-and-identity-controls&quot;&gt;5. Establish authentication and identity controls.&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;Don’t limit the password (within reason). 
Don’t enforce arbitrarily short passwords or limit the type of characters that can be used.
You &lt;strong&gt;do&lt;/strong&gt; want to limit the length, if only to prevent DOS attacks, but 100+ characters shouldn’t be an issue.&lt;/li&gt;
  &lt;li&gt;Check the chosen password against a list of the 100k most common chosen passwords&lt;/li&gt;
  &lt;li&gt;Use a strong, unique salt.
Each credential should have its own salt, and don’t skimp on the length.
64 or 32 characters (depending on the hashing algorithm) should be the norm.&lt;/li&gt;
  &lt;li&gt;Impose a difficult verification on both attacker and defender.
Use a hashing algorithm that’s appropriate, such as PBKDF2, scrypt or bcrypt.
Alternatively, you could use &lt;code class=&quot;highlighter-rouge&quot;&gt;HMAC-SHA-256( [private key], [salt] + [password] )&lt;/code&gt; to only make it hard on the attacker.
However, this introduces a lot more complexity in your system.
Other authentication best practices should also be applied, such as two factor authentication, a proper lockout policy, …&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;a-practical-introduction-to-openid-connect--oauth-20-dominick-baier&quot;&gt;A practical introduction to OpenID Connect &amp;amp; OAuth 2.0 (Dominick Baier)&lt;/h1&gt;
&lt;p&gt;Dominick Baier gave a very interesting talk on OpenID Connect and OAuth 2.0.
An important distinction he made at the start is the difference between a &lt;em&gt;user&lt;/em&gt; and a &lt;em&gt;client&lt;/em&gt;.
Users are people (carbon based life forms) while the word “client” refers to applications (or silicon based life forms).
OAuth2.0 is a protocol meant for client authentication while OpenID is the successor to SAML (and as such meant to authenticate users).
OAuth is &lt;strong&gt;not&lt;/strong&gt; meant for user authentication, even though it’s commonly (ab)used for that through various incompatible, proprietary extensions.&lt;/p&gt;

&lt;h2 id=&quot;openid-connect&quot;&gt;OpenID Connect&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://openid.net/connect&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;OpenID Connect&lt;/a&gt; piggy backs on OAuth2.0.
&lt;img src=&quot;/img/secappdev-2018/OpenIDConnect.png&quot; alt=&quot;OpenId Connect protocol suite&quot; class=&quot;image fit&quot; style=&quot;max-width:638px&quot; /&gt;
It adds support for logging out and key rotation.
More importantly, it’s an &lt;em&gt;open&lt;/em&gt; standard and it publishes a list of &lt;a href=&quot;http://openid.net/certification/&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;certified implementations&lt;/a&gt;.
Compliance with the spec is guaranteed through a set of tests.&lt;/p&gt;

&lt;h2 id=&quot;endpoints&quot;&gt;Endpoints&lt;/h2&gt;
&lt;p&gt;An OpenID Connect server (or token service) has to implement a set of endpoints:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;A discovery endpoint to discover where the other endpoints are.&lt;/li&gt;
  &lt;li&gt;An authorize endpoint (for users)&lt;/li&gt;
  &lt;li&gt;A token endpoint (for machine to machine processes)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;discovery-endpoint&quot;&gt;Discovery endpoint&lt;/h3&gt;
&lt;p&gt;An example of a discovery endpoint is at &lt;a href=&quot;https://accounts.google.com/.well-known/openid-configuration&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;https://accounts.google.com/.well-known/openid-configuration&lt;/a&gt;.
It returns an &lt;strong&gt;unsigned&lt;/strong&gt; JSON document: for security OpenID Connects relies entirely on HTTPS.
The &lt;code class=&quot;highlighter-rouge&quot;&gt;issuer&lt;/code&gt; &lt;strong&gt;must&lt;/strong&gt; be the URL where the document is located.&lt;/p&gt;

&lt;h3 id=&quot;authorize-endpoint&quot;&gt;Authorize endpoint&lt;/h3&gt;
&lt;p&gt;This endpoint handles authentication for web applications and is found in the &lt;code class=&quot;highlighter-rouge&quot;&gt;authorization_endpoint&lt;/code&gt; field of the discovery endpoint
The client (in this case the browser) makes a request to the authorize endpoint and passes along a few required parameters:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The callback url: the token service will verify that this url is allowed and perform a callback to this url after the user is logged on.&lt;/li&gt;
  &lt;li&gt;A nonce (&lt;strong&gt;n&lt;/strong&gt;umber used &lt;strong&gt;once&lt;/strong&gt;) which will be echoed to the client so it can verify server responses.&lt;/li&gt;
  &lt;li&gt;And a scope which needs to include &lt;code class=&quot;highlighter-rouge&quot;&gt;openid&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The server will then authenticate the user and show a consent dialog.
This dialog shows the logged in user, the application that requests access and the access that’s being requested.
&lt;img src=&quot;/img/secappdev-2018/OAuth2Consent.png&quot; alt=&quot;OpenID Connect consent dialog&quot; class=&quot;image fit&quot; style=&quot;max-width:638px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When the user allows this request, the token service sends  response to the client containing a JWT based identity token as well as a cookie.
This means that the token service will remember the user for future logon requests to other applications.&lt;/p&gt;

&lt;h5 id=&quot;identity-token-validation&quot;&gt;Identity token validation&lt;/h5&gt;
&lt;p&gt;When you use an identity token to authenticate to an application, the application needs to validate this token.
It does this by making sure that:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The issuer name matches the value of the &lt;code class=&quot;highlighter-rouge&quot;&gt;iss&lt;/code&gt; claim&lt;/li&gt;
  &lt;li&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;aud&lt;/code&gt; must contain the client-id that was used to register the application.&lt;/li&gt;
  &lt;li&gt;The proper signing algorithm must be defined in &lt;code class=&quot;highlighter-rouge&quot;&gt;alg&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;The current time must be before &lt;code class=&quot;highlighter-rouge&quot;&gt;exp&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;If the token is too old (as defined in &lt;code class=&quot;highlighter-rouge&quot;&gt;iat&lt;/code&gt; or “issued at”), it can be rejected&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;nonce&lt;/code&gt; must match what client sent&lt;/li&gt;
  &lt;li&gt;And you need to validate the signature. 
For that you check the &lt;code class=&quot;highlighter-rouge&quot;&gt;kid&lt;/code&gt; field in the header and use find that key in the document you find at the &lt;code class=&quot;highlighter-rouge&quot;&gt;jwks_uri&lt;/code&gt; field from the discovery endpoint.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;session-management&quot;&gt;Session management&lt;/h2&gt;
&lt;p&gt;Since the token service places a cookie in the user’s browser, this means that you have one logon session active.
When you access another application that uses the same token service, it just needs to show you the consent dialog, without asking you to log in again.
This is called “Single Sign On” (SSO).
OpenID Connect also supports “Single Sign Out”.
When you log out of the token service (by calling the /end_session endpoint), it will try to sign you out from all applications.
It support three different ways of doing this:&lt;/p&gt;

&lt;h3 id=&quot;javascript-based-notification&quot;&gt;Javascript based notification&lt;/h3&gt;
&lt;p&gt;In order to use this, your application should always contain a specific iframe.
The source of this iframe is defined in the &lt;code class=&quot;highlighter-rouge&quot;&gt;check_session_iframe&lt;/code&gt; field of the discovery config.
This frame is loaded in the same origin as the token service and it will do a JS call to the parent page to log out.&lt;/p&gt;

&lt;h3 id=&quot;front-channel-notification&quot;&gt;Front-channel notification&lt;/h3&gt;
&lt;p&gt;Even though the spec calls this a “best-effort approach”, it’s still the method that’s most common.
It requires each client to implement a clean-up endpoint.
When the user logs out, the token service will render an HTML page that containing an invisible iframe for each client.
These iframes will call the clean-up endpoints.
Normally, these iframes will contain the session id in the url to prevent “signout spam”.
Otherwise it would be too easy for a malicious site to add an image to their pages signing you out of your sessions, causing a DOS.
The reason this approach is “best-effort” is that the browser might not be able to call all endpoints before the user navigates away from the log out page.&lt;/p&gt;

&lt;h3 id=&quot;back-channel-notification&quot;&gt;Back-channel notification&lt;/h3&gt;
&lt;p&gt;This is the safest option, as it guarantees that the user will be signed off from all applications.
Unfortunately it’s also the most complicated to implement.
In this method, the token service will call a server-endpoint on all client applications.
This means that the application server will need to implement the clean up endpoint.
Besides that, you also need to be sure that a network connection is possible between the ID provider and all application servers.&lt;/p&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Tim&quot;, &quot;last_name&quot;=&gt;&quot;De Grande&quot;, &quot;twitter&quot;=&gt;&quot;TimDG&quot;, &quot;linkedin&quot;=&gt;&quot;timdegrande&quot;, &quot;permalink&quot;=&gt;&quot;/author/tim-de-grande/&quot;, &quot;avatar&quot;=&gt;&quot;tim-de-grande.jpg&quot;, &quot;title&quot;=&gt;&quot;Principal Consultant&quot;, &quot;title2&quot;=&gt;&quot;Competence Leader Aplication Security&quot;, &quot;email&quot;=&gt;&quot;tim.degrande@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Tim is a principal Java Consultant at Ordina who is interested in security, cryptography and privacy. As Compentence Leader Application Security, he keeps his colleagues up to date on the latest security news and works to broaden their understanding by giving workshops and classes.&quot;}</name><email>tim.degrande@ordina.be</email></author><category term="Security" /><category term="SecAppDev" /><category term="Security" /><category term="Development" /><category term="Conference" /><summary type="html">Last February I was able to attend the 2018 edition of SecAppDev. It’s a training/security conference in Leuven that lasts a week and which hosts top-notch speakers. It’s organised by Philippe De Ryck of imec-DistriNet, KU Leuven.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/secappdev-2018/secappdev_wide.png" /></entry><entry><title type="html">Stairway to Health 2.0 (the Ordina version)</title><link href="https://ordina-jworks.github.io/iot/2018/03/14/Stairway-To-Health-2.html" rel="alternate" type="text/html" title="Stairway to Health 2.0 (the Ordina version)" /><published>2018-03-14T00:00:00+00:00</published><updated>2018-03-14T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/iot/2018/03/14/Stairway-To-Health-2</id><content type="html" xml:base="https://ordina-jworks.github.io/iot/2018/03/14/Stairway-To-Health-2.html">&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.9.0/css/lightbox.css&quot; /&gt;

&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap-grid-only@1.0.0/bootstrap.css&quot; /&gt;

&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js&quot;&gt;&lt;/script&gt;

&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/lightbox2/2.9.0/js/lightbox.min.js&quot;&gt;&lt;/script&gt;

&lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap-grid-only@1.0.0/index.min.js&quot;&gt;&lt;/script&gt;

&lt;h2&gt;Harder, Better, Faster, Stronger&lt;/h2&gt;
&lt;p&gt;Here we are again, another blog post about &lt;a href=&quot;https://stairwayto.health/dashboard&quot;&gt;Stairway to Health&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Why? Well, we’ve created our own Ordina version of the &lt;a href=&quot;https://stairwayto.health/dashboard&quot;&gt;Stairway to Health&lt;/a&gt; application.
There are quite a few interesting bells and whistles, among others, here are a few of the new features:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;New (and awesome) frontend design, with Ordina theming obviously&lt;/li&gt;
  &lt;li&gt;Upgraded from Angular 4 to Angular 5&lt;/li&gt;
  &lt;li&gt;Material Design&lt;/li&gt;
  &lt;li&gt;Nest.js in stead of Express.js (still Express underneath, but cleaner code!)&lt;/li&gt;
  &lt;li&gt;Backend e2e tests with Mockgoose&lt;/li&gt;
  &lt;li&gt;Deployed on OpenShift&lt;/li&gt;
  &lt;li&gt;New type of sensors&lt;/li&gt;
  &lt;li&gt;Cheers feature, users can motivate and support each other&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Stairway to Health @ Ordina&lt;/h2&gt;
&lt;p&gt;As you might have read in our &lt;a href=&quot;https://ordina-jworks.github.io/iot/2017/10/12/Stairway-To-Health.html&quot;&gt;previous post&lt;/a&gt; about Stairway to Health, the purpose of the application is to improve worker health in a fun and engaging way. 
With the app we try to encourage employees to take the stairs instead of the elevator.
We’ve put up some sensors that can detect how much the stairs are used on a per floor basis and how many people take the elevator.
In the app they can see the results and thus they can do an extra effort if they are falling behind.
New in the Ordina version is that employees can now also cheer and motivate each other since we’ve added a chat feature to the application.&lt;/p&gt;

&lt;h2&gt;Internet of Things&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://stairwayto.health/dashboard&quot;&gt;Stairway to Health&lt;/a&gt; project is a simple yet great example to show what the Internet of Things can do:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;LoRa sensors detect door openings, these are installed on the doors of the staircases&lt;/li&gt;
  &lt;li&gt;These sensors communicate via the LoRa network to report their status&lt;/li&gt;
  &lt;li&gt;In our case, sensor data is sent to the Proximus MyThings platform which processes the data&lt;/li&gt;
  &lt;li&gt;The data gets sent to the Stairway to Health application&lt;/li&gt;
  &lt;li&gt;The Stairway to Health application interprets and visualises the data&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In summary: We install sensors on the doors (things) to measure usage and we analyse the data to persuade people to move more.
The result is a good example of how IoT can influence our daily lives.&lt;/p&gt;

&lt;p&gt;For more on this topic, check the application’s &lt;a href=&quot;https://stairwayto.health/about&quot;&gt;About page&lt;/a&gt;&lt;/p&gt;

&lt;h2&gt;Dive into the technical details&lt;/h2&gt;
&lt;p&gt;The reason of us writing this blog post is mainly because we want to explain some of the technical changes and improvements we’ve made
since we’ve updated (pretty much rewritten) the application. 
So let’s get started.&lt;/p&gt;

&lt;h3&gt;The API&lt;/h3&gt;
&lt;p&gt;ExpressJs to Nest.js: The main difference here is that we’ve rewritten the application to use the new framework inf favour of the old implementation with ExpressJs.
Migrating from Express to Nest is not that difficult, since Nest is a wrapper on top of the Express framework.
It provides you with some nice TypeScript decorators which makes your code a lot cleaner, more compact and easier to read.&lt;/p&gt;

&lt;h4&gt;ExpressJs example&lt;/h4&gt;
&lt;div class=&quot;language-typescript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;EntityApi&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;CoreApi&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;entityController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;EntityController&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;EntityController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;// the create function would that have to be executed by the main server while bootstrapping the application&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/auth/entities'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;authenticate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;requireAdmin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;NextFunction&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;entityController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getEntityList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4&gt;NestJs example&lt;/h4&gt;
&lt;div class=&quot;language-typescript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// automatically registered to the server by nest&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// all /auth routes require user to be logged in (doesn't come standard with Nest)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Controller&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/auth/entities'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;UseGuards&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;RolesGuard&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;EntitiesController&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;readonly&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;entitiesService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;EntitiesService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Roles&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'admin'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;findAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;IEntity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;entitiesService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;findAll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;Websockets with NestJs&lt;/h3&gt;
&lt;p&gt;Working with sockets is also a lot easier and cleaner when using Nest.
We can utilise the &lt;code class=&quot;highlighter-rouge&quot;&gt;@WebSocketGateway&lt;/code&gt; to create a new route/gateway, &lt;code class=&quot;highlighter-rouge&quot;&gt;@SubscribeMessage&lt;/code&gt; to listen for certain events and &lt;code class=&quot;highlighter-rouge&quot;&gt;@OnGatewayConnection&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;@OnGatewayDisconnect&lt;/code&gt; to know when users connect or disconnect to the server.
There wasn’t any straight forward solution for broadcasting to all clients. 
Once a user sends a message, we want to update the messages for everyone that has the client open. 
So we solved this by pushing all connected clients to an array and when we receive a ‘cheer-created’ event, we loop over the array of clients and emit an event to them one by one.&lt;/p&gt;

&lt;div class=&quot;language-typescript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;nx&quot;&gt;WebSocketGateway&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SubscribeMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OnGatewayConnection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OnGatewayDisconnect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;nx&quot;&gt;WsResponse&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'@nestjs/websockets'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;WebSocketGateway&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'events/cheers'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;CheerEventsComponent&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OnGatewayConnection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OnGatewayDisconnect&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;

	&lt;span class=&quot;kd&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;nx&quot;&gt;handleConnection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;any&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;nx&quot;&gt;handleDisconnect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;splice&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
				&lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;SubscribeMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'cheer-created'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;nx&quot;&gt;onEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;WsResponse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;broadcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'cheer'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;kr&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;broadcast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clients&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;Optimising chart data and counts&lt;/h3&gt;
&lt;p&gt;On Stairway to Health we used mongo aggregations to get our chart data from the database. 
Once we hit 1.5 million logs, these calls put a lot of stress on our servers and took a long time to load, so in stead we now keep track of daily, weekly, monthly, yearly and total logs in their own collection.
Whenever we receive a log from the MyThings stream we update all these collections. 
For example the daily logs collection contains documents that look like this:&lt;/p&gt;

&lt;div class=&quot;language-json highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;date&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;$date&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;2017-12-20T21:49:15.532Z&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;friendlyName1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;C&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;friendlyName2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;hour&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;identifier&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;20-12-2017&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;counts&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;55&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So when we want the hourly data from a certain day, we query the collection for the date we want and and simply return an array with all the different hours, if an hour doesn’t exist, we assume it didn’t send any logs/counts.
When we receive a log, we check if there is an entry that has “date” and “hour” equal to the log’s date. 
If so, we update, otherwise we create a new entry (upsert).
We still store the log in a “logs” collection, so that if ever our daily, weekly, … collections get corrupted, we can run a script that populates these collections with the correct data.&lt;/p&gt;

&lt;div class=&quot;language-typescript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ILog&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?:&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ILog&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// We insert the log into our logs collection&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;logModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// the identifiers so we can easily query for them&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dailyIdentifier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;day&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;month&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;year&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;weeklyIdentifier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;week&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;year&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;monthlyIdentifier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;month&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;year&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;yearlyIdentifier&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;year&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;c1&quot;&gt;// sensors send all their containers to us, we only need to update the collections&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;// if they are 'counters' and they have a numeric value&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;container&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'counter'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;numericValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

            &lt;span class=&quot;c1&quot;&gt;// update all collections&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// by putting them in a variable, they all get executed without having to wait for each one to complete,&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// and we have no 'callback hell', below te do a Promise.all so that we know when they are all done.&lt;/span&gt;

            &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dailyCountPromise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dailyCountsModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dailyIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;hour&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;hour&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// increment, not overwrite the counts&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;$inc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;counts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;numericValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;// upsert makes sure that if the entry we try to update doesn't exist, we create one&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;upsert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;weeklyCountPromise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;weeklyCountsModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;weeklyIdentifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;day&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;day&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;$inc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;counts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;numericValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;upsert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;totalCountPromise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;totalCountsModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName2&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;$inc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;counts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;numericValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;upsert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;yearlyCountPromise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;yearlyCountsModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;month&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;month&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;yearlyIdentifier&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;$inc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;counts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;numericValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;upsert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;monthlyCountPromise&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;monthlyCountsModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;friendlyName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;week&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;week&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;identifier&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;monthlyIdentifier&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;na&quot;&gt;$inc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;counts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;numericValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;upsert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;

            &lt;span class=&quot;c1&quot;&gt;// once all collections are updated, we emit a 'stream-received' event,&lt;/span&gt;
            &lt;span class=&quot;c1&quot;&gt;// which will reload the charts on the client application&lt;/span&gt;
            &lt;span class=&quot;nb&quot;&gt;Promise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dailyCountPromise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;nx&quot;&gt;weeklyCountPromise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;nx&quot;&gt;totalCountPromise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;nx&quot;&gt;yearlyCountPromise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                          &lt;span class=&quot;nx&quot;&gt;monthlyCountPromise&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                              &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                                  &lt;span class=&quot;nx&quot;&gt;socket&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'stream-received'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                              &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                            &lt;span class=&quot;nx&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
                          &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HttpException&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;BAD_REQUEST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3&gt;The Visible parts&lt;/h3&gt;
&lt;p&gt;The main changes we’ve made on the frontend are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Changing the colours, we created a dark theme with Ordina branding&lt;/li&gt;
  &lt;li&gt;Used material design for a smoother user experience&lt;/li&gt;
  &lt;li&gt;Replaced Highcharts library with &lt;code class=&quot;highlighter-rouge&quot;&gt;@swimlane/ngx-charts&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Migrated to Angular 5&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col-md-4&quot;&gt;
        &lt;a href=&quot;/img/stairwaytohealth2/frontend1.png&quot; data-lightbox=&quot;results&quot; data-title=&quot;&quot;&gt;
            &lt;img alt=&quot;frontend 1&quot; src=&quot;/img/stairwaytohealth2/frontend1.png&quot; class=&quot;image fit&quot; /&gt;
        &lt;/a&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-md-4&quot;&gt;
        &lt;a href=&quot;/img/stairwaytohealth2/frontend2.png&quot; data-lightbox=&quot;results&quot; data-title=&quot;&quot;&gt;
            &lt;img alt=&quot;frontend 2&quot; src=&quot;/img/stairwaytohealth2/frontend2.png&quot; class=&quot;image fit&quot; /&gt;
        &lt;/a&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-md-4&quot;&gt;
        &lt;a href=&quot;/img/stairwaytohealth2/frontend3.png&quot; data-lightbox=&quot;results&quot; data-title=&quot;&quot;&gt;
            &lt;img alt=&quot;frontend 3&quot; src=&quot;/img/stairwaytohealth2/frontend3.png&quot; class=&quot;image fit&quot; /&gt;
        &lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;Since users should now be able to register to the application to cheer for and motivate each other we added these new screens and functionality.&lt;/p&gt;

&lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col-md-6&quot;&gt;
        &lt;a href=&quot;/img/stairwaytohealth2/register.png&quot; data-lightbox=&quot;results&quot; data-title=&quot;&quot;&gt;
            &lt;img alt=&quot;register&quot; src=&quot;/img/stairwaytohealth2/register.png&quot; class=&quot;image fit&quot; /&gt;
        &lt;/a&gt;
    &lt;/div&gt;
    &lt;div class=&quot;col-md-6&quot;&gt;
        &lt;a href=&quot;/img/stairwaytohealth2/cheer.png&quot; data-lightbox=&quot;results&quot; data-title=&quot;&quot;&gt;
            &lt;img alt=&quot;cheers&quot; src=&quot;/img/stairwaytohealth2/cheer.png&quot; class=&quot;image fit&quot; /&gt;
        &lt;/a&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;Deploy on OpenShift&lt;/h3&gt;
&lt;p&gt;Since we’ve separated our frontend and backend code we used 2 separate Git repositories. 
The nice thing about deploying to OpenShift is that we can add a webhook to GitHub so that every time we merge a pull request from our develop branch to our
master branch to our Git remote, it builds and deploys the new code immediately.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/img/stairwaytohealth2/stack.png&quot; data-lightbox=&quot;results&quot; data-title=&quot;&quot;&gt;
    &lt;img alt=&quot;stack&quot; src=&quot;/img/stairwaytohealth2/stack.png&quot; class=&quot;image fit&quot; /&gt;
&lt;/a&gt;&lt;/p&gt;

&lt;h3&gt;The new sensors: Proximus MySense&lt;/h3&gt;
&lt;p&gt;For the previous version of Stairway to Health we used Magnetic door sensors,
these use a magnet mounted on the door frame and the sensor mounted on the door itself, when the door is closed the magnet
makes contact with the sensor and the sensor detects the door is closed. This means you need to mount at two places,
and it needs to be carefully placed to align. This makes it not an ideal solution.&lt;/p&gt;

&lt;p&gt;A solution for this is the MySense sensor. This is a LoRa sensor programmable with JavaScript.&lt;/p&gt;

&lt;p&gt;The MySense is a small LoRa device containing multiple sensors.
It contains a temperature sensor, a button, …
But the most important sensor for our case is the accelerometer.
Using the accelerometer we can detect when the door is moving. After detecting a motion we will blackout the sensor
for 30 seconds to allow the door to be closed again and not count multiple motions.&lt;/p&gt;

&lt;p&gt;To save battery we do not send on every motion,
but count the amount of motions for 15 minutes and then send the counter,
also when the counter is 0 we will not send to save battery.&lt;/p&gt;

&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;We made some major improvements when it comes to performance, maintainability and functionality.
By deploying our application to OpenShift, we also improved our workflow and made it a lot easier to deploy our changes.
By using the MySense as our sensor we only have to mount one piece per door. An extra advantage is that this sensor is a lot cheaper.&lt;/p&gt;

&lt;h3&gt;Interesting Links&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://stairwayto.health/dashboard&quot;&gt;Stairway to Health 2.0&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://ordina-jworks.github.io/iot/2017/10/12/Stairway-To-Health.html&quot;&gt;Blogpost Stairway to Health 1&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://nestjs.com/&quot;&gt;Nest.js&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.openshift.com/&quot;&gt;OpenShift&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Michael&quot;, &quot;last_name&quot;=&gt;&quot;Vervloet&quot;, &quot;permalink&quot;=&gt;&quot;/author/michael-vervloet/&quot;, &quot;avatar&quot;=&gt;&quot;michael-vervloet.jpg&quot;, &quot;linkedin&quot;=&gt;&quot;michaelvervloet&quot;, &quot;twitter&quot;=&gt;&quot;MiVvlt&quot;, &quot;github&quot;=&gt;&quot;MiVvlt&quot;, &quot;title&quot;=&gt;&quot;SoftWare Engineer&quot;, &quot;title2&quot;=&gt;&quot;Fullstack Javascript Developer&quot;, &quot;email&quot;=&gt;&quot;michael.vervloet@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Michael is a full stack JavaScript/TypeScript developer specialising himself in backend development with NodeJs and Express and has a solid background in frontend/hybrid mobile development. As a member of Ordina's core 'Internet of Things' team he has collaborated on some challenging and innovative IoT applications.&quot;}</name><email>michael.vervloet@ordina.be</email></author><category term="IoT" /><category term="NodeJS" /><category term="nestJs" /><category term="MongoDB" /><category term="Angular" /><category term="ExpressJS" /><category term="Express" /><category term="TypeScript" /><category term="Angular-CLI" /><category term="Internet of Things" /><category term="IoT" /><category term="LoRa" /><summary type="html"></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/stairwaytohealth2/banner.jpg" /></entry><entry><title type="html">HPKP is deprecated. What now?</title><link href="https://ordina-jworks.github.io/security/2018/02/12/HPKP-deprecated-what-now.html" rel="alternate" type="text/html" title="HPKP is deprecated. What now?" /><published>2018-02-12T00:00:00+00:00</published><updated>2018-02-12T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/security/2018/02/12/HPKP-deprecated-what-now</id><content type="html" xml:base="https://ordina-jworks.github.io/security/2018/02/12/HPKP-deprecated-what-now.html">&lt;h1 id=&quot;hpkp-is-deprecated-what-now&quot;&gt;HPKP is deprecated. What now?&lt;/h1&gt;

&lt;blockquote&gt;
  &lt;p&gt;Recently Google announced their intent to &lt;a href=&quot;https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/he9tr7p3rZ8/eNMwKPmUBAAJ&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;deprecate support&lt;/a&gt; for Public Key Pinning (HPKP).
Let’s have a look at the reasons for this and what technologies we can use to replace it.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;deprecated-why&quot;&gt;Deprecated? Why?&lt;/h2&gt;
&lt;p&gt;As mentioned in the &lt;a href=&quot;/conference/2017/09/18/Browser-security-features.html&quot;&gt;previous blog post&lt;/a&gt;, HPKP carries some very strong risks.
It only takes a small mistake to render your site completely inaccessible, but that’s only 1 of the reasons Google mentions for deprecating support for HPKP.
The other risks they call out are that it’s hard to build a pin-set that’s guaranteed to work and the risk of hostile pinning.
Hostile pinning hasn’t been observed &lt;em&gt;yet&lt;/em&gt;, but it’s an attack that allows someone to take your site hostage should they somehow be able to obtain a valid certificate for your domain.&lt;/p&gt;

&lt;p&gt;Because of the first 2 reasons, adoption rates of HPKP have remained very low and browser vendors have been looking for a viable replacement.&lt;/p&gt;

&lt;h2 id=&quot;expect-ct&quot;&gt;Expect-CT&lt;/h2&gt;
&lt;p&gt;One of the new headers thought up to replace HPKP is &lt;code class=&quot;highlighter-rouge&quot;&gt;Expect-CT&lt;/code&gt; (Expect Certificate Transparency).
This tells the browser to check the &lt;a href=&quot;https://www.certificate-transparency.org/&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Certificate Transparency&lt;/a&gt; (CT) logs to make sure the presented certificate is properly logged.&lt;/p&gt;

&lt;h3 id=&quot;certificate-transparency&quot;&gt;Certificate Transparency&lt;/h3&gt;
&lt;p&gt;CT is a project by Google that provides a framework for monitoring and auditing SSL certificates in (almost) real-time.
One of the reasons for its existence is the 2011 hack of the Dutch CA Diginotar. 
This resulted in the hackers being able to issue more than 500 fake SSL certificates (including for sites like facebook.com and google.com).
In turn, these certificates could then be used by the attacker to perform a Man-in-the-middle (MitM) attack against these sites, without alerting the user that anything fishy was going on.&lt;/p&gt;

&lt;p&gt;CT is a tool that allows you to detect when a fake certificate has been issued. 
When a CA participates in the program, it has to log all certificates they issue in a publicly searchable log.
These logs are monitored by applications which can report to you whenever a new certificate for one of your domains is issued.
If the certificate was issued in error (or maliciously), you can immediately take steps to have it revoked.&lt;/p&gt;

&lt;h3 id=&quot;how-does-expect-ct-help-me-out-here&quot;&gt;How does Expect-CT help me out here?&lt;/h3&gt;
&lt;p&gt;Expect-CT tells the browser that you only want it to trust certificates signed by CAs that have Certificate Transparency enabled.
When the server presents a certificate that’s not issued by such a CA, the browser will reject it and display a warning to the user.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/img/2018-hpkp-deprecation/expect-ct-error.png&quot; alt=&quot;Expect CT error message&quot; class=&quot;image fit&quot; style=&quot;max-width:638px&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If you combine these 2 points, you can see how this protects your users:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;By monitoring the CT logs, you can quickly identify any fraudulent or misissued certificates for yur domains and have them revoked.&lt;/li&gt;
  &lt;li&gt;If the certificate is issued by a CT that doesn’t pop up in these logs, it’s simply rejected by the browser.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;how-to-monitor-ct-logs&quot;&gt;How to monitor CT logs&lt;/h3&gt;
&lt;p&gt;Of course the whole premise of this solution is that you actually monitor the CT logs for your domains.
If you don’t do this, you’re still at risk of someone obtaining a fraudulent certificate and impersonating you.
Fortunately, there are plenty of companies and tools out there that can help you out with this.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;SSLMate offers an open source tool called &lt;a href=&quot;https://github.com/SSLMate/certspotter&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Certspotter&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;If you don’t want to run it yourself, you can &lt;a href=&quot;https://sslmate.com/certspotter/&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;pay them&lt;/a&gt; to do it for you.&lt;/li&gt;
  &lt;li&gt;For smaller (personal) projects, you can use &lt;a href=&quot;https://developers.facebook.com/tools/ct/&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;Facebook&lt;/a&gt;’s monitor.&lt;/li&gt;
  &lt;li&gt;Or you use one of the other APIs or services that are available.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;What’s important is that you get the reports quickly so you can immediately take action.&lt;/p&gt;

&lt;h3 id=&quot;use-the-header&quot;&gt;Use the header&lt;/h3&gt;
&lt;p&gt;Since (to my knowledge) browsers don’t have psychic powers (yet?), you still need to tell it that you expect the CA to have CT enabled.
For that you’ll need to add the &lt;code class=&quot;highlighter-rouge&quot;&gt;Expect-CT&lt;/code&gt; header on your responses.
Obviously it will only look for these on an HTTPS URL, since on a simple HTTP connection it can easily be added or removed by a MitM.&lt;/p&gt;

&lt;p&gt;The header looks like this:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http request
Expect-CT: enforce, max-age=31536000, report-uri=&quot;https://example.com&quot;
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This tells the browser to &lt;strong&gt;enforce&lt;/strong&gt; the CT rule and to do so for the next year.
Any infractions will be sent to the &lt;code class=&quot;highlighter-rouge&quot;&gt;report-uri&lt;/code&gt; you mentioned.
As with all headers that contain a &lt;code class=&quot;highlighter-rouge&quot;&gt;report-uri&lt;/code&gt;, you can also use &lt;a href=&quot;https://report-uri.io&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;report-uri.io&lt;/a&gt; to aggregate these logs.&lt;/p&gt;

&lt;p&gt;As with most things that stand a chance of rendering your site inaccessible, it pays to be cautious when adding this header.
Typically you don’t want to start by adding this header as defined above.
Instead, you want to deploy it first &lt;em&gt;without&lt;/em&gt; the &lt;code class=&quot;highlighter-rouge&quot;&gt;enforce&lt;/code&gt; directive (and preferably a very low &lt;code class=&quot;highlighter-rouge&quot;&gt;max-age&lt;/code&gt; such as 0)
Doing so will tell the browser that you don’t want it to &lt;strong&gt;block&lt;/strong&gt; connections with a bad certificate, but just to send the error to the &lt;code class=&quot;highlighter-rouge&quot;&gt;report-uri&lt;/code&gt;.
This setup allows you to test without impacting your users: you can now monitor this for a while to see if everything still works as expected.
After that, enable the &lt;code class=&quot;highlighter-rouge&quot;&gt;enforce&lt;/code&gt; directive and slowly increase the &lt;code class=&quot;highlighter-rouge&quot;&gt;max-age&lt;/code&gt; to the point you want it to be.&lt;/p&gt;

&lt;h3 id=&quot;risks&quot;&gt;Risks&lt;/h3&gt;
&lt;p&gt;The risk of adding this header is quite low, if you follow the procedure above.
You should only make sure that your CA actually uses CT.
However, since October 2017 Chrome has made this a requirement in order for CAs to be in the trust-store.
The main risk lies in not monitoring the CT logs properly. 
If you don’t monitor the alerts or don’t have a procedure to deal with misissued certificates, you’re still at risk of impersonation.&lt;/p&gt;

&lt;h3 id=&quot;caveats&quot;&gt;Caveats&lt;/h3&gt;
&lt;p&gt;Unfortunately, there’s one major caveat to using this header.
At the time of writing, only Chrome fully supports Expect-CT.
Mozilla has also indicated that they will support it, but Microsoft so far doesn’t seem to be following suit.&lt;/p&gt;

&lt;h3 id=&quot;should-you-use-it&quot;&gt;Should you use it?&lt;/h3&gt;
&lt;p&gt;Yes. The risk is minimal, the only downside at the moment is the lack of browser support.
At the very least, a large percentage of your users enjoys added protection against MitM attacks.&lt;/p&gt;

&lt;h2 id=&quot;certificate-authority-authorization&quot;&gt;Certificate Authority Authorization&lt;/h2&gt;
&lt;p&gt;The downside of Expect-CT compared to Public Key Pinning (HPKP) is that you need to make sure that your monitoring is handled correctly.
If you don’t notice on time that a certificate has been issued, an attacker may be able to impersonate you for some time.
You can make this a lot harder on the attacker by using Certificate Authority Authorization (CAA).
CAA is a way for you to indicate exactly who is allowed to issue certificates for your domain.&lt;/p&gt;

&lt;h3 id=&quot;how-to-implement&quot;&gt;How to implement?&lt;/h3&gt;
&lt;p&gt;Since the issuance of certificates is not limited to websites, CAA is not implemented through HTTPS response headers, instead it’s a record that you need to put in your DNS settings.
You simply add the correct record to your DNS like this:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Type&lt;/th&gt;
      &lt;th&gt;Value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;example.com.&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CAA&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0 issue &quot;;&quot;&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;blockquote&gt;
  &lt;p&gt;Note: the example above prevents all CAs from issuing certificates for your site. 
Don’t just copy-paste this.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;You can have multiple CAA records and the value of these tells the CA exactly what you want.
Since this is a bit cryptic, lets look a bit more in detail at what’s happening here.&lt;/p&gt;

&lt;p&gt;The value above consists of 3 parts:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;the flag (&lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;the tag (&lt;code class=&quot;highlighter-rouge&quot;&gt;issue&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;the value (&lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;;&quot;&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The combination of tag and value can be referred to as “the property”.
The whole of CAA is governed by &lt;a href=&quot;https://tools.ietf.org/html/rfc6844&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RFC 6844&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;flags&quot;&gt;Flags&lt;/h4&gt;
&lt;p&gt;Currently, flags can have 2 values: &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;128&lt;/code&gt;.
A value of &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt; means the property is non-critical, while a value of &lt;code class=&quot;highlighter-rouge&quot;&gt;128&lt;/code&gt; means that is is critical.
If a property is marked as critical, the CA must completely understand it before it proceeds.
Generally it’s correct to use &lt;code class=&quot;highlighter-rouge&quot;&gt;0&lt;/code&gt;, so it’s advised to always use that value.
There is support for customized flags in the RFC, but that’s beyond the scope of this post.&lt;/p&gt;

&lt;h4 id=&quot;tags&quot;&gt;Tags&lt;/h4&gt;
&lt;p&gt;The current specification has 3 tags you can define:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;issue&lt;/code&gt; specifies which CA is authorized to issue certificates&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;issuewild&lt;/code&gt; indicates which CA is authorized to issue &lt;strong&gt;wildcard&lt;/strong&gt; certificates (e.g. for &lt;code class=&quot;highlighter-rouge&quot;&gt;*.example.com&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;iodef&lt;/code&gt; similar to report-uri you can use this to get reports on invalid requests (either to an email address or to an http endpoint)&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;issue&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;issue&lt;/code&gt;&lt;/h5&gt;
&lt;p&gt;This tag specifies which CA is allowed to issue certificates for the domain and its subdomains.
This includes the wildcard subdomain (meaning that the certificate would be valid for &lt;em&gt;all&lt;/em&gt; subdomains).
A value of “;” indicates that no issuance is allowed.
You’re allowed to define multiple CAs, but you’ll need to use a new DNS record for each one:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Type&lt;/th&gt;
      &lt;th&gt;Value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;example.com.&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CAA&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0 issue &quot;ca1.com&quot;&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;example.com.&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CAA&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0 issue &quot;otherca.net&quot;&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h5 id=&quot;issuewild&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;issuewild&lt;/code&gt;&lt;/h5&gt;
&lt;p&gt;This one is used explicitly for wildcard certificates.
If &lt;code class=&quot;highlighter-rouge&quot;&gt;issuewild&lt;/code&gt; is present, any values in &lt;code class=&quot;highlighter-rouge&quot;&gt;issue&lt;/code&gt; may not be used in the issuance of a wildcard certificate.
You can use this in case you never want a wildcard certificate to be issued or when the list of CAs that are allowed to issue wildcard certificates differs from the original list.&lt;/p&gt;

&lt;h5 id=&quot;iodef&quot;&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;iodef&lt;/code&gt;&lt;/h5&gt;
&lt;p&gt;You can use this tag to report invalid certificate requests:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Name&lt;/th&gt;
      &lt;th&gt;Type&lt;/th&gt;
      &lt;th&gt;Value&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;example.com.&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CAA&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0 iodef &quot;mailto:certificates@example.com&quot;&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;example.com.&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;CAA&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;0 iodef &quot;https://certificate.example.com/endpoint&quot;&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;As you can see, you can either have these reports sent by email, of have them delivered to an HTTP endpoint.
The report is sent in the IODEF format, which also means that your endpoint needs to be &lt;a href=&quot;https://www.ietf.org/rfc/rfc6546.txt&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;RFC 6546&lt;/a&gt; compliant.&lt;/p&gt;

&lt;h3 id=&quot;the-easy-way&quot;&gt;The easy way&lt;/h3&gt;
&lt;p&gt;To help you in creating your CAA, SSL Mate has released a useful tool: &lt;a href=&quot;https://sslmate.com/caa/&quot; target=&quot;blank&quot; rel=&quot;noopener noreferrer&quot;&gt;CAA Record Helper&lt;/a&gt;.
It can help you create a CAA record and will tell you how to set it up in your DNS service.
&lt;img src=&quot;/img/2018-hpkp-deprecation/sslmate.png&quot; alt=&quot;CAA Record Helper&quot; class=&quot;image fit&quot; style=&quot;max-width:881px&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;risks-1&quot;&gt;Risks&lt;/h3&gt;
&lt;p&gt;A badly implemented CAA record can mean that your CA is not allowed to issue your certificate.
The other risk is that it relies on DNS: DNS records can be spoofed and this might allow an attacker to trick a CA into issuing a fraudulent certificate.
Because of this, the RFC recommends implementing DNSSEC (Domain Name Security Extensions).&lt;/p&gt;

&lt;h3 id=&quot;should-i-use-it&quot;&gt;Should I use it?&lt;/h3&gt;
&lt;p&gt;I’d suggest you do. 
While having an incorrect policy can prevent the CA from issuing a certificate, this situation can be rectified quickly and shouldn’t put your users at risk.
It will make it a lot harder for an attacker to obtain a certificate.&lt;/p&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Tim&quot;, &quot;last_name&quot;=&gt;&quot;De Grande&quot;, &quot;twitter&quot;=&gt;&quot;TimDG&quot;, &quot;linkedin&quot;=&gt;&quot;timdegrande&quot;, &quot;permalink&quot;=&gt;&quot;/author/tim-de-grande/&quot;, &quot;avatar&quot;=&gt;&quot;tim-de-grande.jpg&quot;, &quot;title&quot;=&gt;&quot;Principal Consultant&quot;, &quot;title2&quot;=&gt;&quot;Competence Leader Aplication Security&quot;, &quot;email&quot;=&gt;&quot;tim.degrande@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Tim is a principal Java Consultant at Ordina who is interested in security, cryptography and privacy. As Compentence Leader Application Security, he keeps his colleagues up to date on the latest security news and works to broaden their understanding by giving workshops and classes.&quot;}</name><email>tim.degrande@ordina.be</email></author><category term="Security" /><category term="Security" /><category term="Browser features" /><category term="Response headers" /><category term="HPKP" /><category term="CAA" /><category term="Expect-CT" /><summary type="html">HPKP is deprecated. What now?</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/security/padlock_code.jpg" /></entry><entry><title type="html">Azure Draft</title><link href="https://ordina-jworks.github.io/docker/2018/02/12/Azure-Draft.html" rel="alternate" type="text/html" title="Azure Draft" /><published>2018-02-12T00:00:00+00:00</published><updated>2018-02-12T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/docker/2018/02/12/Azure-Draft</id><content type="html" xml:base="https://ordina-jworks.github.io/docker/2018/02/12/Azure-Draft.html">&lt;h1 id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#installing-draft&quot;&gt;Installing Draft&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#setting-sail-with-draft&quot;&gt;Setting Sail with Draft&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/Azure/draft&quot;&gt;Draft&lt;/a&gt; is an open-source tool from Microsoft Azure.
It attempts to make the development for Kubernetes clusters easier, 
by getting Docker and Kubernetes out of the way.&lt;/p&gt;

&lt;p&gt;Developers no longer require Docker,
and can just push their applications to a remote Kubernetes clusters using Draft.
Draft accomplishes this by using only two simple commands.&lt;/p&gt;

&lt;p&gt;The first command is &lt;code class=&quot;highlighter-rouge&quot;&gt;draft create&lt;/code&gt;.
This tool detects the application language, 
and writes out a Dockerfile and a &lt;a href=&quot;https://github.com/kubernetes/helm&quot;&gt;Kubernetes Helm&lt;/a&gt; chart in the source tree.
These files are generated based on Draft “packs”.
These packs are simple scripts that only detect the language
and write out the Dockerfile and Helm charts.
The idea is based on some features of PaaS systems like the CloudFoundry’s &lt;em&gt;buildpacks&lt;/em&gt;.
The only difference is that the build and deployment descriptors are stored in the source tree.&lt;/p&gt;

&lt;p&gt;The second command is &lt;code class=&quot;highlighter-rouge&quot;&gt;draft up&lt;/code&gt;.
First, all source code will be uploaded to any Kubernetes cluster, 
local or remote.
Then, the application is built on the cluster using the generated Dockerfile.
Finally, the built image is deployed to a dev environment using the Helm Chart.&lt;/p&gt;

&lt;p&gt;Draft does not support many languages yet, 
but it currently supports most of the popular languages like Java, Python, Golang, JavaScript, Ruby, Swift, PHP, C# and Clojure.
It also has support for Gradle and Maven projects.
You can see all packs &lt;a href=&quot;https://github.com/Azure/draft/tree/master/packs&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;installing-draft&quot;&gt;Installing Draft&lt;/h2&gt;

&lt;p&gt;Before you can start using Draft,
there are quite a few components that need to be set up.
However, 
if you are using a remote Kubernetes cluster,
you will only need to do the setup once for multiple developers.
Other developers will only need to install the Draft client to benefit.
For this example, we will be using Minikube, 
a local Kubernetes cluster.&lt;/p&gt;

&lt;p&gt;The total list of tools required is the following:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Minikube: a local Kubernetes cluster&lt;/li&gt;
  &lt;li&gt;kubectl: the CLI tool for working with Kubernetes&lt;/li&gt;
  &lt;li&gt;Tiller: the Helm agent running on the Kubernetes cluster which manages installations of your charts.&lt;/li&gt;
  &lt;li&gt;Helm: the Helm client&lt;/li&gt;
  &lt;li&gt;Draftd: the Draft agent running on the Kubernetes cluster&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Let’s get started!&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Downloading all dependencies&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;We will start by installing the latest release of Minikube using &lt;a href=&quot;https://github.com/Homebrew/brew&quot;&gt;Homebrew&lt;/a&gt;.
If you do not have Homebrew,
you can check how to install Minikube &lt;a href=&quot;https://kubernetes.io/docs/tasks/tools/install-minikube/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brew cask install minikube
==&amp;gt; Satisfying dependencies
All Formula dependencies satisfied.
==&amp;gt; Downloading https://storage.googleapis.com/minikube/releases/v0.25.0/minikube-darwin-amd64
==&amp;gt; Verifying checksum for Cask minikube
==&amp;gt; Installing Cask minikube
==&amp;gt; Linking Binary 'minikube-darwin-amd64' to '/usr/local/bin/minikube'.
minikube was successfully installed!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After Minikube has been installed,
we can install Azure Draft!
First, we add the Azure Draft repository by adding a Homebrew tap.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brew tap azure/draft
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now that we have added the repository,
we can install Draft!&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ brew install draft
==&amp;gt; Installing draft from azure/draft
==&amp;gt; Downloading https://azuredraft.blob.core.windows.net/draft/draft-v0.10.1-darwin-amd64.tar.gz
/usr/local/Cellar/draft/0.10.1: 5 files, 45.9MB, built in 1 second
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you do not use Homebrew,
you can download the latest release of Draft &lt;a href=&quot;https://github.com/Azure/draft/releases&quot;&gt;here&lt;/a&gt;.
You will have to unzip the download and add it to your PATH manually.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Starting Minikube&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Now we have downloaded all required dependencies,
we can start setting up our cluster.
Let’s start our Kubernetes cluster.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ minikube start
Starting local Kubernetes v1.9.0 cluster...
Starting VM...
Downloading Minikube ISO
Getting VM IP address...
Moving files into cluster...
Downloading localkube binary
Connecting to cluster...
Setting up kubeconfig...
Starting cluster components...
Kubectl is now configured to use the cluster.
Loading cached images from config file.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The cluster is up and ready. 
As you can see from the output,
Minikube also configured our kubectl client by automatically creating a .kubeconfig file.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ kubectl cluster-info
Kubernetes master is running at https://192.168.99.100:8443

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Enabling the Docker Registry&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;To be able to use our Draft agent on the server,
we will need to enable the embedded Docker registry on the cluster.
Minikube makes this straightforward using an addon.
We only need to enable it!&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ minikube addons enable registry
registry was successfully enabled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Installing Helm&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Now that we have our Minikube up and running,
we can install the Helm server agent (Tiller) and the Helm client.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ helm init
$HELM_HOME has been configured at /Users/tomverelst/.helm.

Tiller (the Helm server-side component) has been installed into your Kubernetes Cluster.
Happy Helming!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even though Tiller is installed now,
you must wait for it to be deployed.
Wait until there is one instance ready!&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ kubectl -n kube-system get deploy tiller-deploy --watch
NAME            DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
tiller-deploy   1         1         1            1           4m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;Installing Draft&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;All requirements are set up now for Draft.
Let’s install the final component: Draft!&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ draft init --auto-accept
Installing default plugins...
Installation of default plugins complete
Installing default pack repositories...
Installing pack repo from https://github.com/Azure/draft
Error: Unable to update checked out version: exit status 128
Error: exit status 1
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Uh, oh! Seems like Git cannot clone the Draft pack repo.
According to &lt;a href=&quot;https://github.com/Azure/draft/issues/522&quot;&gt;this GitHub issue&lt;/a&gt;,
this happens with Git version 2.16+.&lt;/p&gt;

&lt;p&gt;If you have this error, the workaround currently is to manually add a specific version of the pack repo.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ draft pack-repo add https://github.com/Azure/draft --version v0.10.0
Installing pack repo from https://github.com/Azure/draft
Installed pack repository github.com/Azure/draft
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We manually installed the Draft pack repo now. 
Let’s try to set up Draft again.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ draft init --auto-accept
Installing default plugins...
Installation of default plugins complete
Installing default pack repositories...
Installation of default pack repositories complete
$DRAFT_HOME has been configured at /Users/tomverelst/.draft.

Draft detected that you are using minikube as your cloud provider. AWESOME!
Draftd has been installed into your Kubernetes Cluster
Happy Sailing!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Great.
The workaround works! 
As you can see, Draft is still in alpha and will not properly work yet.&lt;/p&gt;

&lt;p&gt;This setup is of course for local development.
If you want to have a production ready, RBAC enabled, Draft setup on a remote Kubernetes cluster,
you can take a look at the &lt;a href=&quot;https://github.com/Azure/draft/blob/master/docs/install-advanced.md&quot;&gt;Advanced Installation guide&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;setting-sail-with-draft&quot;&gt;Setting Sail with Draft&lt;/h2&gt;

&lt;p&gt;If you managed to get to this point,
you either went through all the effort to set everything up,
or you skipped to this part!&lt;/p&gt;

&lt;p&gt;We can now start drafting up some applications. 
Since I am a fan of Go, 
I will start with drafting up a Go application.
Here is a simple Go application that listens on port 8080 and returns “Hello Draft!”.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;net/http&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ResponseWriter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Fprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Hello Draft!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HandleFunc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ListenAndServe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;:8080&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s run it to see if it works.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ go run main.go

# Open a separate terminal
$ curl localhost:8080
Hello, Draft!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The application works. 
Now we can let Draft create the Dockerfile and the Helm chart.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ draft create
--&amp;gt; Draft detected Go (100.000000%)
--&amp;gt; Ready to sail
$ ls
Dockerfile	charts		draft.toml	main.go
$ ls charts/go
Chart.yaml	charts		templates	values.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Draft detected that it was a Go application, 
It generated a Dockerfile and the Draft deployment descriptor,
and it also copied the Go pack to the &lt;code class=&quot;highlighter-rouge&quot;&gt;charts&lt;/code&gt; directory.
This is great, as it enables the possibility to customize the pack for this specific application.&lt;/p&gt;

&lt;p&gt;Let’s take a look at the generated Dockerfile.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ cat Dockerfile
FROM golang:onbuild
ENV PORT 8080
EXPOSE 8080
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The official Golang &lt;em&gt;onbuild&lt;/em&gt; image is used.
This image is great for development purposes,
but I would not recommend using this image for production purposes,
as it is around &lt;strong&gt;700MB&lt;/strong&gt;, 
while the application is only a few lines of code.&lt;/p&gt;

&lt;p&gt;For demo purposes, 
let’s continue to use this generated Dockerfile,
and try to deploy our application on Kubernetes using Draft.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ draft up
Draft Up Started: 'goapp'
goapp: Building Docker Image: SUCCESS ?  (60.1681s)
goapp: Pushing Docker Image: SUCCESS ?  (63.0775s)
goapp: Releasing Application: SUCCESS ?  (0.5346s)
goapp: Build ID: 01C653GK70A7SR2FMT2325TBHD
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Building and pushing this application took around 2 minutes,
which seems pretty long,
but that is highly likely because of the 700MB base Docker image.
This image first needs to be downloaded.
Then it needs to be pushed to the registry.&lt;/p&gt;

&lt;p&gt;We can connect to the application using &lt;code class=&quot;highlighter-rouge&quot;&gt;draft connect&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ draft connect
Connecting to your app...SUCCESS...Connect to your app on localhost:50066
Starting log streaming...
+ exec app
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s see how the application is installed on our cluster.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ kubectl get deployment
NAME       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
goapp-go   2         2         2            2           5m

$ kubectl get svc
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE
goapp-go     ClusterIP   10.103.78.13   &amp;lt;none&amp;gt;        80/TCP    4m
kubernetes   ClusterIP   10.96.0.1      &amp;lt;none&amp;gt;        443/TCP   1h

$ kubectl get pods
NAME                       READY     STATUS    RESTARTS   AGE
goapp-go-88f4b7bc7-4cltn   1/1       Running   0          4m
goapp-go-88f4b7bc7-wt7kx   1/1       Running   0          4m
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see,
our application has successfully been deployed to Kubernetes,
and is deployed using a Kubernetes &lt;em&gt;Deployment&lt;/em&gt; resource.&lt;/p&gt;

&lt;p&gt;The services are not exposed by default,
so we will need to either use &lt;code class=&quot;highlighter-rouge&quot;&gt;kubectl port-forward &amp;lt;pod&amp;gt; 8080&lt;/code&gt;,
or SSH into our cluster.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ minikube ssh
$ curl 10.103.78.13
Hello Draft! 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you want to expose your applications automatically using Draft,
you can use a Kubernetes &lt;em&gt;Ingress Controller&lt;/em&gt; for this.
You will need to enable an &lt;em&gt;Ingress Controller&lt;/em&gt; in Kubernetes (&lt;code class=&quot;highlighter-rouge&quot;&gt;minikube addons enable ingress&lt;/code&gt;),
and initialize draft with the &lt;code class=&quot;highlighter-rouge&quot;&gt;--ingress-enabled&lt;/code&gt; flag.
More information about this can be found &lt;a href=&quot;https://github.com/Azure/draft/blob/master/docs/ingress.md&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Deploying changes&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Draft is meant to be used during development,
so it is important we can push changes.
Let’s make a change to our application.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;func handler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, &quot;Bye Draft!&quot;)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now that we have made some changes,
let’s try to deploy our new version.
This is done using the same command.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ draft up
Draft Up Started: 'goapp'
goapp: Building Docker Image: SUCCESS ?  (12.0163s)
goapp: Pushing Docker Image: SUCCESS ?  (16.0110s)
goapp: Releasing Application: SUCCESS ?  (0.2311s)
goapp: Build ID: 01C65507WTBX5EAJKWWR53T652
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The build time has gone down from 2 minutes, to 28 seconds.
This is because the Golang Docker image no longer needs to be downloaded and/or pushed to the Docker registry.&lt;/p&gt;

&lt;p&gt;The deployment is updated with the new version of the application.
Old pods are taken down by Kubernetes and new ones are started.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$ kubectl get pods
NAME                        READY     STATUS              RESTARTS   AGE
goapp-go-6fb684d887-2kq69   0/1       ContainerCreating   0          23s
goapp-go-6fb684d887-qmth6   1/1       Running             0          23s
goapp-go-88f4b7bc7-wt7kx    0/1       Terminating         0          19m

$ minikube ssh
$ curl 10.103.78.13
Bye  Draft! 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Our changes are now deployed to the Kubernetes cluster!&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;Draft is great for local development using Kubernetes.
It is meant to be used before committing and pushing your code.&lt;/p&gt;

&lt;p&gt;Applications can be deployed to Kubernetes within minutes,
without requiring to write Dockerfiles and/or Kubernetes resource files.&lt;/p&gt;

&lt;p&gt;Azure Draft is still experimental for now, 
but the development team is active, 
and I have not run into many issues yet.&lt;/p&gt;

&lt;p&gt;It brings one of CloudFoundry’s best features, namely build packs, to Kubernetes.
It’s definitely worth a try!&lt;/p&gt;

&lt;h2 id=&quot;resources&quot;&gt;Resources&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://draft.sh&quot;&gt;Draft website&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/azure/draft&quot;&gt;Draft GitHub&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://helm.sh/&quot;&gt;Helm&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Tom&quot;, &quot;last_name&quot;=&gt;&quot;Verelst&quot;, &quot;permalink&quot;=&gt;&quot;/author/tom-verelst/&quot;, &quot;avatar&quot;=&gt;&quot;tom-verelst.png&quot;, &quot;twitter&quot;=&gt;&quot;tomverelst&quot;, &quot;linkedin&quot;=&gt;&quot;tomverelst&quot;, &quot;github&quot;=&gt;&quot;tomverelst&quot;, &quot;title&quot;=&gt;&quot;Principal Consultant&quot;, &quot;title2&quot;=&gt;&quot;Competence Leader Cloud Native Platforms&quot;, &quot;email&quot;=&gt;&quot;tom.verelst@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Tom is a senior software engineer at Ordina Belgium. He is fond of all things Go and DevOps.&quot;}</name><email>tom.verelst@ordina.be</email></author><category term="Docker" /><category term="Azure" /><category term="Draft" /><category term="Kubernetes" /><category term="Helm" /><category term="Docker" /><category term="CloudFoundry" /><category term="PaaS" /><summary type="html">Table of contents Introduction Installing Draft Setting Sail with Draft Conclusion</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/2018-02-12-Azure-Draft/draft-logo.png" /></entry><entry><title type="html">Mocking in Kotlin with MockK</title><link href="https://ordina-jworks.github.io/testing/2018/02/05/Writing-tests-in-Kotlin-with-MockK.html" rel="alternate" type="text/html" title="Mocking in Kotlin with MockK" /><published>2018-02-05T00:00:00+00:00</published><updated>2018-02-05T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/testing/2018/02/05/Writing-tests-in-Kotlin-with-MockK</id><content type="html" xml:base="https://ordina-jworks.github.io/testing/2018/02/05/Writing-tests-in-Kotlin-with-MockK.html">&lt;h1 id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#introduction&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#mockito-and-its-shortcomings-in-kotlin&quot;&gt;Mockito and its shortcomings in Kotlin&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#the-idiomatic-mocking-framework-for-kotlin&quot;&gt;The idiomatic mocking framework for Kotlin&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#summing-it-all-up&quot;&gt;Summing it all up&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#other-useful-links&quot;&gt;Other useful links&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;I have been pretty excited about Kotlin since JetBrains released the &lt;a href=&quot;https://blog.jetbrains.com/kotlin/2016/02/kotlin-1-0-released-pragmatic-language-for-jvm-and-android/&quot; target=&quot;_blank&quot;&gt;first official version&lt;/a&gt; on the 15th of February 2016.
It did take me a while before I managed to get my hands dirty, which was in between the version 1.1 and 1.2 release.
Besides developing in Java, which I’m doing full time as a senior Java consultant, 
I’ve also been dabbling in Scala for quite some years with Lightbend’s &lt;a href=&quot;https://www.playframework.com&quot; target=&quot;_blank&quot;&gt;Play Framework&lt;/a&gt;.
Everyone knows how verbose Java is, and how it lags a bit behind the newer, fancier programming languages.
It still misses features such as pattern matching, case/data classes and local-variable type inference.&lt;/p&gt;

&lt;p&gt;Starting from Java 8 with the introduction of Lambdas, we have finally been given the option to add a more functional programming flavour to our code which was due in time.
Scala felt very refreshing for me back then, when I started to use it which was shortly before the JDK 7 release.
It felt clean and powerful, bringing the best of both worlds of object-oriented programming and functional programming.
At the same time, Scala houses a lot of complexity since there are so many ways and styles to tackle problems.
You could compare it a bit to having the toolkit available to build a space rocket when you only plan on building a small airplane. 
And this is where Kotlin comes in, being very similar to Scala but with a focus on practicality and simplicity.
Coming from the industry instead of academia, it focuses on solving problems faced daily by programmers.&lt;/p&gt;

&lt;p&gt;I’m a big fan of Test-Driven Development and thoroughly testing the behaviour of my code by making use of mocks.
&lt;a href=&quot;http://site.mockito.org&quot; target=&quot;_blank&quot;&gt;Mockito&lt;/a&gt; has been my mocking framework of choice combined with &lt;a href=&quot;https://github.com/powermock/powermock&quot; target=&quot;_blank&quot;&gt;PowerMock&lt;/a&gt; for mocking constructors, static and private methods, and more.
As Kotlin also runs on the JVM, it can make use of the huge Java ecosystem.
It was a no-brainer for me to immediately add these testing libraries to my Kotlin project for writing my tests.&lt;/p&gt;

&lt;p&gt;And thus I set off, creating a new Kotlin project to see how it fared.&lt;/p&gt;

&lt;h2 id=&quot;mockito-and-its-shortcomings-in-kotlin&quot;&gt;Mockito and its shortcomings in Kotlin&lt;/h2&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:500px;&quot; alt=&quot;Mockito logo&quot; src=&quot;/img/writing-tests-in-kotlin-with-mockk/mockito.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;I started off with adding the Mockito dependency to my Kotlin project.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.mockito&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mockito-core&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.13.0&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And wrote a first simple test in which I wanted to test a &lt;code class=&quot;highlighter-rouge&quot;&gt;Service&lt;/code&gt; class that uses a &lt;code class=&quot;highlighter-rouge&quot;&gt;Generator&lt;/code&gt; to generate a record and a &lt;code class=&quot;highlighter-rouge&quot;&gt;Dao&lt;/code&gt; for persisting it.&lt;/p&gt;

&lt;div class=&quot;language-kotlin highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ServiceTest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Generator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Random String that's not random&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Dao&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;Inserting &quot;$record&quot;&quot;&quot;&quot;) }
&lt;/span&gt;    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;calculate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;record&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;generator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Generator&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;dao&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dao&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;myTest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;mockedRecord&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;mocked String&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;`when`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thenReturn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mockedRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;calculate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mockedRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;verifyNoMoreInteractions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Writing the test went pretty smooth although the code looks a bit funky.
When I ran it, I stumbled on this nice error:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;org.mockito.exceptions.base.MockitoException: 
Cannot mock/spy class be.yannickdeturck.HelloTest$Generator
Mockito cannot mock/spy because :
 - final class
 — anonymous classes
 — primitive types
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As all classes and methods are final by default in Kotlin, using Mockito appears to be a bit problematic due to how Mockito creates its mocks.
If you are interested in how Mockito’s mocking works internally you should checkout &lt;a href=&quot;https://stackoverflow.com/a/14447878/1320126&quot; target=&quot;_blank&quot;&gt;this response on StackOverflow&lt;/a&gt; that roughly sums it up.&lt;/p&gt;

&lt;p&gt;I did a bit more research on using Mockito and stumbled upon this &lt;a href=&quot;https://github.com/nhaarman/mockito-kotlin&quot; target=&quot;_blank&quot;&gt;slightly tuned version&lt;/a&gt; for Kotlin, wrapping some of Mockito’s functionalities, providing a simpler API.
I decided to try that one out and replaced my Mockito dependency with it:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.nhaarman&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mockito-kotlin&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.5.0&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I rewrote my test a bit in order to make use of the cleaner syntax the library had to offer.
Note how both defining and using the mocks is a bit more elegant:&lt;/p&gt;

&lt;div class=&quot;language-kotlin highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ServiceTest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Generator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Random String that's not random&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Dao&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;Inserting &quot;$record&quot;&quot;&quot;&quot;) }
&lt;/span&gt;    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;calculate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;record&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;generator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;dao&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;()&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;myTest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;mockedRecord&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;mocked String&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;whenever&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;thenReturn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mockedRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;calculate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;verify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mockedRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Mockito&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;verifyNoMoreInteractions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sadly, we still have the Mockito error.&lt;/p&gt;

&lt;p&gt;As I said, in Kotlin all classes and methods are final by default which &lt;a href=&quot;https://github.com/mockito/mockito/issues/657&quot; target=&quot;_blank&quot;&gt;Mockito cannot deal with&lt;/a&gt;.
You would have to explicitly make your classes inheritable using the &lt;code class=&quot;highlighter-rouge&quot;&gt;open&lt;/code&gt; modifier.
Another approach would be to add interfaces to everything.
Changing your code just for the sake of being able to write good tests is something I’m not exactly fond of, and in this case we are also getting around one of the key features of Kotlin.&lt;/p&gt;

&lt;p&gt;Starting from Mockito version &lt;code class=&quot;highlighter-rouge&quot;&gt;2.0.0&lt;/code&gt; it did &lt;a href=&quot;https://github.com/mockito/mockito/wiki/What%27s-new-in-Mockito-2#unmockable&quot; target=&quot;_blank&quot;&gt;became possible to mock final classes&lt;/a&gt; although it is an incubating, opt-in feature.
This however, requires a bit of a setup really.
It basically consists of creating a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;org.mockito.plugins.MockMaker&lt;/code&gt; with as content &lt;code class=&quot;highlighter-rouge&quot;&gt;mock-maker-inline&lt;/code&gt; and placing it under &lt;code class=&quot;highlighter-rouge&quot;&gt;resources/mockito-extensions&lt;/code&gt;.
It felt a bit hacky but apparently this is only a temporary way to set it up.
Although there are supposed to be plans to make it more straightforward.
&lt;a href=&quot;https://twitter.com/hhariri&quot; target=&quot;_blank&quot;&gt;Hadi Hariri&lt;/a&gt; wrote an extensive &lt;a href=&quot;http://hadihariri.com/2016/10/04/Mocking-Kotlin-With-Mockito/&quot; target=&quot;_blank&quot;&gt;blog post&lt;/a&gt; on setting this up and you should check it out if you would like to learn more about it.&lt;/p&gt;

&lt;p&gt;Good, so this makes it possible to create mocks without having to add the &lt;code class=&quot;highlighter-rouge&quot;&gt;open&lt;/code&gt; modifier to all your classes and methods!
It does’t appear to be completely compatible with Mockito Kotlin even though the library depends on Mockito version &lt;code class=&quot;highlighter-rouge&quot;&gt;2.8.9&lt;/code&gt;.
Trying to run the test resulted in the following error:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;org.mockito.exceptions.base.MockitoInitializationException: 
Could not initialize inline Byte Buddy mock maker. (This mock maker is not supported on Android.)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At the time of writing there is a version &lt;code class=&quot;highlighter-rouge&quot;&gt;2.0.0&lt;/code&gt; in alpha for Mockito Kotlin so I tried to switch to it to see if it changed anything.
Note that the dependency is a bit different and you need to use the classes in the &lt;code class=&quot;highlighter-rouge&quot;&gt;com.nhaarman.mockitokotlin2&lt;/code&gt; package:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.nhaarman.mockitokotlin2&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mockito-kotlin&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;2.0.0-alpha02&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It got rid of the above error.
I did ran into some unexpected behaviour where my mocks’ behaviour was rather unexpected when I also added partial mocking using spies.
I spent some time to get my head around it and during my quest for answers I stumbled upon this library called &lt;a href=&quot;http://mockk.io&quot; target=&quot;_blank&quot;&gt;MockK&lt;/a&gt;, created by &lt;a href=&quot;https://twitter.com/oleksiyp&quot; target=&quot;_blank&quot;&gt;Oleksiy Pylypenko&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I decided to check it out as I became a bit annoyed with Mockito in Kotlin so far.&lt;/p&gt;

&lt;h2 id=&quot;the-idiomatic-mocking-framework-for-kotlin&quot;&gt;The idiomatic mocking framework for Kotlin&lt;/h2&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:500px;&quot; alt=&quot;MockK logo&quot; src=&quot;/img/writing-tests-in-kotlin-with-mockk/mockk.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;Although I am a huge fan of Mockito for mocking in Java, using Mockito in Kotlin just feels a bit too Java-ish when you have this elegant Kotlin code all around in your project. 
MockK’s main philosophy is offering first-class support for Kotlin features and being able to write idiomatic Kotlin code when using it.
Adding MockK is as simple as ever as you only have to add the dependency to your project and you are set to go.&lt;/p&gt;

&lt;p&gt;Maven:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;io.mockk&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;mockk&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.7.1&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Gradle:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;testCompile &quot;io.mockk:mockk:1.7.1&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The available &lt;a href=&quot;http://mockk.io&quot; target=&quot;_blank&quot;&gt;MockK documentation&lt;/a&gt; provides a really nice overview of all the different features with a lot of examples, making it very easy to get started.
If you have used a mocking framework before such as Mockito, everything should come natural as you usually do when writing tests with mocks.
You have the same three parts in which your tests are divided:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Preparing the test data and setting up the mocking&lt;/li&gt;
  &lt;li&gt;Executing the logic that you want to test&lt;/li&gt;
  &lt;li&gt;Performing the necessary validation and verification checks to see if the result and behaviour matches your expectations.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The test from above is written as follows:&lt;/p&gt;

&lt;div class=&quot;language-kotlin highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ServiceTest&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Generator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Random String that's not random&quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Dao&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&quot;&quot;Inserting &quot;$record&quot;&quot;&quot;&quot;) }
&lt;/span&gt;    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;calculate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;record&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;record&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;generator&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mockk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;dao&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mockk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;()&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;myTest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;mockedRecord&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;mocked String&quot;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;every&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;returns&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mockedRecord&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;every&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mockedRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;just&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runs&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;calculate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;verifyAll&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;generator&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mockedRecord&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Going over the example, everything should feel familiar but more elegant.
You may however, wonder what the &lt;code class=&quot;highlighter-rouge&quot;&gt;every { dao.insert(mockedRecord) } just Runs&lt;/code&gt; line is doing exactly.
By default in MockK, mocks are strict so you need to provide some behaviour for them.
If we were to omit the line, the test would fail as we would run into the following error:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;io.mockk.MockKException: no answer found for: Dao(#2).insert(mocked String)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A feature I was immediately fond of as I like to write strict tests.
Note that you can also define the mock as being a &lt;em&gt;relaxed mock&lt;/em&gt; in order to avoid this strict behaviour:&lt;/p&gt;

&lt;div class=&quot;language-kotlin highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;dao&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mockk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Dao&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;relaxed&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Mockito has something similar for verifying with &lt;code class=&quot;highlighter-rouge&quot;&gt;Mockito.verifyNoMoreInteractions(generator, dao)&lt;/code&gt; which I also extensively use to enforce that all calls of mocked objects are verified.
Of course, the above example is only the tip of the iceberg as MockK houses a ton of other features such as annotations to simplify creating mock objects, 
spying to mix mocks and real objects, partial argument matching, capturing arguments, verification order support, matchers, coroutine mocking support, and so much more.&lt;/p&gt;

&lt;p&gt;After fiddling with Mockito, I happily continued using MockK for my little Kotlin project.&lt;/p&gt;

&lt;h2 id=&quot;summing-it-all-up&quot;&gt;Summing it all up&lt;/h2&gt;
&lt;p&gt;Mockito for me felt a bit hacky/unnatural and too Java-ish when using it in a Kotlin project.
I imagine it will probably become better in the near future.&lt;/p&gt;

&lt;p&gt;MockK, being a newer library specifically targeted at Kotlin, felt clean and pleasant to use with excellent documentation.
Oleksiy is also actively working on the library as you can see in the repo’s &lt;a href=&quot;https://github.com/oleksiyp/mockk/releases&quot; target=&quot;_blank&quot;&gt;releases section&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I highly recommend checking out MockK for mocking in a Kotlin project as it is currently a better option in my humble opinion.
Oleksiy is also very active on the &lt;a href=&quot;https://gitter.im/mockk-io/Lobby&quot; target=&quot;_blank&quot;&gt;MockK Gitter&lt;/a&gt; and he helps you out quickly should you have any questions.
He is also open to feedback and enjoys being challenged in order to make MockK an even better library.
If you want to learn more about MockK, you should definitely read Oleksiy’s blog post series in the next section.&lt;/p&gt;

&lt;h2 id=&quot;other-useful-links&quot;&gt;Other useful links&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://mockk.io&quot; target=&quot;_blank&quot;&gt;MockK documenation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/oleksiyp/mockk&quot; target=&quot;_blank&quot;&gt;MockK GitHub&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://gitter.im/mockk-io/Lobby&quot; target=&quot;_blank&quot;&gt;MockK Gitter&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://twitter.com/oleksiyp&quot; target=&quot;_blank&quot;&gt;Oleksiy Pylypenko’s Twitter&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://hadihariri.com/2016/10/04/Mocking-Kotlin-With-Mockito/&quot; target=&quot;_blank&quot;&gt;Blog post by Hadi Hariri: Mocking Kotlin with Mockito&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.kotlin-academy.com/mocking-is-not-rocket-science-basics-ae55d0aadf2b&quot; target=&quot;_blank&quot;&gt;Blog post by Oleksiy Pylypenko: Mocking is not rocket science: Basics&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.kotlin-academy.com/mocking-is-not-rocket-science-expected-behavior-and-behavior-verification-3862dd0e0f03&quot; target=&quot;_blank&quot;&gt;Blog post by Oleksiy Pylypenko: Mocking is not rocket science: Expected behavior and behavior verification&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.kotlin-academy.com/mocking-is-not-rocket-science-mockk-features-e5d55d735a98&quot; target=&quot;_blank&quot;&gt;Blog post by Oleksiy Pylypenko: Mocking is not rocket science: MockK features&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Yannick&quot;, &quot;last_name&quot;=&gt;&quot;De Turck&quot;, &quot;twitter&quot;=&gt;&quot;YannickDeTurck&quot;, &quot;linkedin&quot;=&gt;&quot;yannickdeturck&quot;, &quot;github&quot;=&gt;&quot;yannickdeturck&quot;, &quot;permalink&quot;=&gt;&quot;/author/yannick-de-turck/&quot;, &quot;avatar&quot;=&gt;&quot;yannick-de-turck.jpg&quot;, &quot;title&quot;=&gt;&quot;Senior Consultant&quot;, &quot;title2&quot;=&gt;&quot;Competence Lead JVM Languages&quot;, &quot;email&quot;=&gt;&quot;Yannick.DeTurck@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Yannick is a senior Java consultant and competence lead of the JVM languages competence center at Ordina Belgium. He's very much interested in everything Java and Spring related as well as reactive programming, Kotlin, Lightbend technologies, software architectures, and coaching and enabling other colleagues.&quot;}</name><email>Yannick.DeTurck@ordina.be</email></author><category term="Testing" /><category term="Kotlin" /><category term="MockK" /><category term="Unit Testing" /><category term="Mocking" /><category term="Mockito" /><category term="TDD" /><category term="Test-Driven Development" /><summary type="html">Table of contents Introduction Mockito and its shortcomings in Kotlin The idiomatic mocking framework for Kotlin Summing it all up Other useful links</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/writing-tests-in-kotlin-with-mockk/mockk.png" /></entry><entry><title type="html">Visualizing your Spring Integration components &amp;amp; flows</title><link href="https://ordina-jworks.github.io/architecture/2018/01/27/Visualizing-your-Spring-Integration-components-and-flows.html" rel="alternate" type="text/html" title="Visualizing your Spring Integration components &amp; flows" /><published>2018-01-27T00:00:00+00:00</published><updated>2018-01-27T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/architecture/2018/01/27/Visualizing-your-Spring-Integration-components-and-flows</id><content type="html" xml:base="https://ordina-jworks.github.io/architecture/2018/01/27/Visualizing-your-Spring-Integration-components-and-flows.html">&lt;blockquote&gt;
  &lt;p&gt;This post can be useful for everyone who wants to have insights on their application’s internal architecture when integrating with other systems using Spring Integration.
From the developer that just started in your team and who wants to have an overview, to the seasoned team member that needs to troubleshoot a problem in production.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Currently we are working on the phased roll out of a microservices architecture at one of our clients.
To ensure that everything works as it’s supposed to we are using a lot of &lt;a href=&quot;http://enterpriseintegrationpatterns.com/&quot; target=&quot;_blank&quot;&gt;Enterprise Integration Patterns&lt;/a&gt; to stitch both the old and the new landscape together.
The best way to achieve a solution when using Java, is to use Spring Integration.
A few days ago we wanted to have clear insights on how certain microservices are communicating with the existing systems.&lt;/p&gt;

&lt;h2 id=&quot;creating-your-graph-of-spring-integration-components-and-flows&quot;&gt;Creating your graph of Spring Integration components and flows&lt;/h2&gt;

&lt;p&gt;A first step to expose your Spring Integration components and flows is to add an &lt;code class=&quot;highlighter-rouge&quot;&gt;IntegrationGraphServer&lt;/code&gt; bean to your application.
This class resides in the &lt;code class=&quot;highlighter-rouge&quot;&gt;o.s.i.support.management.graph&lt;/code&gt; package, between all the required classes to collect, build and render the runtime state of Spring Integration components as a single tree-like &lt;code class=&quot;highlighter-rouge&quot;&gt;Graph&lt;/code&gt; object.&lt;/p&gt;

&lt;h2 id=&quot;exposing-the-graph&quot;&gt;Exposing the graph&lt;/h2&gt;

&lt;p&gt;Using the Spring Integration HTTP module you can easily expose the &lt;code class=&quot;highlighter-rouge&quot;&gt;IntegrationGraphServer&lt;/code&gt; functionality as a REST service.
Just add the &lt;code class=&quot;highlighter-rouge&quot;&gt;@EnableIntegrationGraphController&lt;/code&gt; annotation to your application, and you’re good to go!
Or, in case you are using XML config, add the &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;int-http:graph-controller/&amp;gt;&lt;/code&gt; XML element to your setup.
Be sure to edit the &lt;code class=&quot;highlighter-rouge&quot;&gt;allowedOrigins&lt;/code&gt; attribute of the annotation in case you’re accessing the endpoint between 2 domains.
Sidenote: your application needs to be deployed on a web container, or it needs to use an embedded web container in case you are building on top of Spring Boot.&lt;/p&gt;

&lt;h2 id=&quot;visualizing-the-exposed-graph-of-components-and-flows&quot;&gt;Visualizing the exposed graph of components and flows&lt;/h2&gt;

&lt;p&gt;With &lt;a href=&quot;https://d3js.org/&quot; target=&quot;_blank&quot;&gt;D3.js&lt;/a&gt; we are able to visualize everything within our graph.
In &lt;a href=&quot;https://gist.github.com/TYsewyn/99f86b42ec4fbedf06db611a1a04bea4&quot; target=&quot;_blank&quot;&gt;this quick &amp;amp; dirty gist&lt;/a&gt; I created, you can find a simple example of a possible visualisation.
Download the &lt;code class=&quot;highlighter-rouge&quot;&gt;index.html&lt;/code&gt; file, point the script to the correct endpoint by editing the &lt;code class=&quot;highlighter-rouge&quot;&gt;graphEndpoint&lt;/code&gt; variable, open the file in your browser and you should see every component and flow!&lt;/p&gt;

&lt;p&gt;As Gary Russell pointed out in &lt;a href=&quot;https://twitter.com/gprussell/status/957370937741111296&quot; target=&quot;_blank&quot;&gt;his reply&lt;/a&gt; to my tweet you can also use Spring Flo for the visualization.
Spring Flo is an Angular based, embeddable graphical component for pipeline/graph building and editing.
This is used as the basis of the stream builder in Spring Cloud Data Flow.
You can find the sample application &lt;a href=&quot;https://github.com/spring-projects/spring-flo/tree/angular-1.x/samples/spring-flo-si&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;taking-it-one-step-further&quot;&gt;Taking it one step further&lt;/h2&gt;

&lt;p&gt;If you add the &lt;code class=&quot;highlighter-rouge&quot;&gt;@EnableIntegrationManagement&lt;/code&gt; annotation or the &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;int:management /&amp;gt;&lt;/code&gt; XML element to your setup, the graph will even expose all the metrics of your Spring Integration components.
This will definitely help you out when you want to monitor your components and flows, enabling you to troubleshoot problems even faster in case something goes wrong in production.&lt;/p&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Tim&quot;, &quot;last_name&quot;=&gt;&quot;Ysewyn&quot;, &quot;avatar&quot;=&gt;&quot;tim-ysewyn.png&quot;, &quot;twitter&quot;=&gt;&quot;TYsewyn&quot;, &quot;linkedin&quot;=&gt;&quot;tysewyn&quot;, &quot;github&quot;=&gt;&quot;TYsewyn&quot;, &quot;permalink&quot;=&gt;&quot;/author/tim-ysewyn/&quot;, &quot;title&quot;=&gt;&quot;Principal Consultant&quot;, &quot;title2&quot;=&gt;&quot;Competence Leader API &amp; Microservices&quot;, &quot;email&quot;=&gt;&quot;Tim.Ysewyn@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Tim is a Principal Consultant at Ordina, where he helps fellow developers discovering top-notch technologies and methodologies as a Competence Leader for API &amp; Microservices. You can also find him working on various parts of the &lt;a href=\&quot;https://www.spring.io\&quot; target=\&quot;_blank\&quot;&gt;Spring&lt;/a&gt; framework or helping out at &lt;a href=\&quot;https://ng-be.org\&quot; target=\&quot;_blank\&quot;&gt;NG-BE&lt;/a&gt;. When you can\\'t get a hold of him, he will probably be under water since he is also an underwater photographer &amp; rescue diver.&quot;}</name><email>Tim.Ysewyn@ordina.be</email></author><category term="Architecture" /><category term="Spring" /><category term="Integration" /><category term="Spring Integration" /><category term="EIP" /><category term="Microservices" /><summary type="html">This post can be useful for everyone who wants to have insights on their application’s internal architecture when integrating with other systems using Spring Integration. From the developer that just started in your team and who wants to have an overview, to the seasoned team member that needs to troubleshoot a problem in production.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/2018-01-27-Visualizing-your-Spring-Integration-components-and-flows/post-image.jpg" /></entry><entry><title type="html">The JWorks Tech Radar</title><link href="https://ordina-jworks.github.io/tech/2018/01/20/JWorks-Tech-Blog.html" rel="alternate" type="text/html" title="The JWorks Tech Radar" /><published>2018-01-20T00:00:00+00:00</published><updated>2018-01-20T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/tech/2018/01/20/JWorks-Tech-Blog</id><content type="html" xml:base="https://ordina-jworks.github.io/tech/2018/01/20/JWorks-Tech-Blog.html">&lt;blockquote&gt;
  &lt;p&gt;The JWorks Technology Radar is intended to showcase our opinion on the most important tech trends we see today.
It is based on the Thoughtworks Technology Radar and uses its open source framework for visualization.
We adopted the mechanics and methodology from Thoughtworks, as described below.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Our tech radar can be reached through &lt;a href=&quot;https://ordina-jworks.github.io/tech-radar&quot;&gt;this link&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;the-radar&quot;&gt;The Radar&lt;/h2&gt;

&lt;p&gt;The Radar is a document that sets out the changes that we think are currently interesting in software development - things in motion that we think you should pay attention to and consider using in your projects.
It reflects the idiosyncratic opinion of a bunch of senior technologists and is based on our day-to-day work and experiences.
While we think this is interesting, it shouldn’t be taken as a deep market analysis.&lt;/p&gt;

&lt;h2 id=&quot;quadrants&quot;&gt;Quadrants&lt;/h2&gt;

&lt;p&gt;The quadrants are a categorization of the type of blips:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Programming Languages and Frameworks.&lt;/strong&gt; Quite straight-forward, languages and software frameworks.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Tools.&lt;/strong&gt; These can be components, such as databases, software development tools, such as Versions Control Systems; or more generic categories of tools, such as the notion of polyglot persistence.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Platforms.&lt;/strong&gt; Things that we build software on top of such as mobile technologies like Android, virtual platforms like the JVM, or generic kinds of platforms like hybrid clouds.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Techniques.&lt;/strong&gt; These include elements of a software development process, such as experience design; and ways of structuring software, such as microservices.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;We don’t make a big deal out of the quadrants - they’re really just a way to break up the Radar into topic areas. We don’t think it’s important which quadrant a blip goes into, unlike the rings - which generate a lot of discussion.&lt;/p&gt;

&lt;h2 id=&quot;rings&quot;&gt;Rings&lt;/h2&gt;

&lt;p&gt;The metaphor of a radar says that the closer a blip is to you, the sooner it will be on top of you. Like most metaphors, you can’t take it too seriously, but there’s an essential sense to it.&lt;/p&gt;

&lt;p&gt;Our Radar has four rings, which we’ll describe starting from the middle:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The &lt;strong&gt;Adopt&lt;/strong&gt; ring represents blips that we think you should be using now. We don’t say that you should use these for every project; any tool should only be used in an appropriate context. However we do think that a blip in the Adopt ring represents something where there’s no doubt that it’s proven and mature for use.&lt;/li&gt;
  &lt;li&gt;The &lt;strong&gt;Trial&lt;/strong&gt; ring is for blips that we think are ready for use, but not as completely proven as those in the Adopt ring. So for most organizations we think you should use these on a trial basis, to decide whether they should be part of your toolkit. Typically we’re happy to use trial blips now, but we realize that most readers will be more cautious than us.&lt;/li&gt;
  &lt;li&gt;The &lt;strong&gt;Assess&lt;/strong&gt; ring are things that you should look at closely, but not necessarily trial yet - unless you think they would be a particularly good fit for you. Typically, blips in the Assess ring are things that we’re currently trialling, on our projects.&lt;/li&gt;
  &lt;li&gt;The &lt;strong&gt;Hold&lt;/strong&gt; ring is for things that are getting attention in the industry, but we don’t think are ready for use. Sometimes this is because we don’t think they’re mature enough yet: sometimes it means we think they’re irredeemably flawed. We don’t have an “avoid” ring, but we do throw things in the Hold ring that we wish our clients wouldn’t use.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Unlike the quadrants, we do have some quite passionate arguments about which ring a blip should go into. We don’t tend to have angry debates, but rings are what generate the most energetic discussions. Over the course of making the Radar we’ve come up with some useful rules of thumb to help us put things into rings.&lt;/p&gt;

&lt;p&gt;We can only put blips into the Trial ring when we have experience of that blip on a real project. This can mean we sometimes look behind the technology curve, because we may like the look of a technology but haven’t yet persuaded a client to try it out - and until we do that blip cannot pass into Trial.&lt;/p&gt;

&lt;p&gt;For the Adopt ring, we only include items when we think it would be a poor and potentially irresponsible choice not to use them given the appropriate project context.&lt;/p&gt;

&lt;p&gt;More information can be found on the &lt;a href=&quot;https://www.thoughtworks.com/radar/faq&quot;&gt;Thoughtworks website&lt;/a&gt;.&lt;/p&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Andreas&quot;, &quot;last_name&quot;=&gt;&quot;Evers&quot;, &quot;permalink&quot;=&gt;&quot;/author/andreas-evers/&quot;, &quot;avatar&quot;=&gt;&quot;andreas-evers.jpg&quot;, &quot;title&quot;=&gt;&quot;Principal Consultant&quot;, &quot;email&quot;=&gt;&quot;andreas.evers@ordina.be&quot;, &quot;twitter&quot;=&gt;&quot;andreasevers&quot;, &quot;github&quot;=&gt;&quot;andreasevers&quot;, &quot;title2&quot;=&gt;&quot;Practice Leader Backend&quot;, &quot;linkedin&quot;=&gt;&quot;eversandreas&quot;, &quot;bio&quot;=&gt;&quot;Andreas is a Principal Java consultant at Ordina, passionate about the Spring ecosystem, microservices, REST, clean code and best practices in general. An avid open source enthusiast and Spring contributor. Helps fellow developers as Competence Center leader for architecture and best practices by giving workshops, talks and courses about the newest technologies.&quot;}</name><email>andreas.evers@ordina.be</email></author><category term="Tech" /><category term="Tech Radar" /><summary type="html">The JWorks Technology Radar is intended to showcase our opinion on the most important tech trends we see today. It is based on the Thoughtworks Technology Radar and uses its open source framework for visualization. We adopted the mechanics and methodology from Thoughtworks, as described below.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/techradar/TechRadar.png" /></entry><entry><title type="html">Automated testing with Gauge</title><link href="https://ordina-jworks.github.io/testing/2018/01/05/Gauge-automated-testing.html" rel="alternate" type="text/html" title="Automated testing with Gauge" /><published>2018-01-05T00:00:00+00:00</published><updated>2018-01-05T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/testing/2018/01/05/Gauge-automated-testing</id><content type="html" xml:base="https://ordina-jworks.github.io/testing/2018/01/05/Gauge-automated-testing.html">&lt;p&gt;After finishing a new feature in your web app, you test whether it works.
However, while working on that new feature, you may have broken something else.
If you want to know for sure, you have to test everything.
Clicking around, filling in forms, … will cost you some valuable time.
So, you’ll probably end up not doing it thorough enough or even not at all, assuming everything else still works fine.
That’s exactly why you should have automated tests do it for you!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://getgauge.io/&quot; target=&quot;_blank&quot;&gt;Gauge&lt;/a&gt; is yet another test automation tool that serves that purpose.
The founder is &lt;a href=&quot;https://www.thoughtworks.com/&quot; target=&quot;_blank&quot;&gt;ThoughtWorks&lt;/a&gt;, the company that also created  &lt;a href=&quot;http://www.seleniumhq.org/&quot; target=&quot;_blank&quot;&gt;Selenium&lt;/a&gt; and &lt;a href=&quot;https://www.gocd.org/&quot; target=&quot;_blank&quot;&gt;GoCD&lt;/a&gt;.
It’s still in beta at the moment of writing, but it already works terrific!
Gauge is comparable with Protractor or JUnit extended with Cucumber (if you haven’t heard of these, they are worth checking out).
In this blog we’ll be mainly talking about automating browser testing using Selenium WebDriver, although that isn’t the sole purpose of Gauge.
If you don’t know WebDriver, it’s what allows you to interact with the browser to traverse the DOM, click on elements and so on.&lt;/p&gt;

&lt;p&gt;Now, unlike Cucumber, Gauge itself only supports three languages at the moment: Java, Ruby and C#.
Others may be supported by the community like JavaScript.
You can define steps written in either one of those languages.
These are the actual tests and can be identified by a sentence you can choose yourself.
By combining these sentences, you can write test scenarios which are written in Markdown.
That means you don’t need any programming experience to write test scenarios.
You could create some sort of dictionary with the step sentences that others can use for the scenarios or the other way around.
In other words, anyone is able to read and write test scenarios.
The actual implementation of the steps does require some technical knowledge.&lt;/p&gt;

&lt;h1 id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#setup&quot;&gt;Setup&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#writing-tests&quot;&gt;Writing tests&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#running-the-specs&quot;&gt;Running the specs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#environments-and-configuration&quot;&gt;Environments and configuration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#reports&quot;&gt;Reports&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;setup&quot;&gt;Setup&lt;/h1&gt;
&lt;p&gt;Gauge offers an installer which can be downloaded &lt;a href=&quot;https://getgauge.io/get-started.html&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt;.
During the install, you can select which core plugins to install.
In this blog the tests are written in Java, so we would need the Java core plugin.
After the install, you’ll be able to run &lt;code class=&quot;highlighter-rouge&quot;&gt;gauge&lt;/code&gt; from the command line.
It can, for example, be used to install more plugins (as well as core plugins &lt;code class=&quot;highlighter-rouge&quot;&gt;gauge install java&lt;/code&gt;).&lt;/p&gt;

&lt;p&gt;Next, in order to use WebDriver in our tests, we’ll need the Java SDK and Maven.
When you’re a Java developer, you probably already have those installed.
If not, you’ll find enough on Google on how to install those.&lt;/p&gt;

&lt;p&gt;To start a new project, create a new folder and run &lt;code class=&quot;highlighter-rouge&quot;&gt;gauge init java&lt;/code&gt; in it.
This will setup a basic Gauge project.
Then we need to add a &lt;a href=&quot;https://github.com/getgauge-examples/java-maven-selenium/blob/master/pom.xml&quot; target=&quot;_blank&quot;&gt;pom.xml&lt;/a&gt; file ourselves, because we need some dependencies such as Selenium WebDriver.
Next, WebDriver needs to be set up in our test code.
A good example of how you could do that can be found &lt;a href=&quot;https://github.com/getgauge-examples/java-maven-selenium/tree/master/src/test/java/utils&quot; target=&quot;_blank&quot;&gt;here&lt;/a&gt;.
They created a &lt;code class=&quot;highlighter-rouge&quot;&gt;DriverFactory&lt;/code&gt; so you can easily switch between browsers using environment variables (we’ll get to that).
Gauge hooks are used to start and stop WebDriver when running the test suite.
Just copy those pieces of code into your own project.
Or, you could start from the &lt;em&gt;Maven + Selenium&lt;/em&gt; example provided by Gauge which can be found on &lt;a href=&quot;https://github.com/getgauge-examples/java-maven-selenium&quot; target=&quot;_blank&quot;&gt;GitHub&lt;/a&gt;.
That way you’d have some examples to start from.&lt;/p&gt;

&lt;p&gt;Now we can start writing tests.&lt;/p&gt;

&lt;h1 id=&quot;writing-tests&quot;&gt;Writing tests&lt;/h1&gt;
&lt;p&gt;On the lowest level we have our Java functions that control the browser using WebDriver commands.
To these functions we can assign a &lt;code class=&quot;highlighter-rouge&quot;&gt;@Step&lt;/code&gt; annotation to be able to identify it.
It’s usually a sentence describing the action being performed.
The sentences can then be used to write the scenarios of our tests (or specs).
If you’d like to combine multiple steps into once sentence, you can do so by creating so called “concepts”.&lt;/p&gt;

&lt;p&gt;A typical folder structure for a Gauge setup using WebDriver and Java is as follows:&lt;/p&gt;
&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;max-width:194px&quot; alt=&quot;Gauge Maven project structure&quot; src=&quot;/img/2018-01-05-gauge-automated-testing/files.jpg&quot; /&gt;
&lt;/p&gt;

&lt;h3 id=&quot;writing-the-specs&quot;&gt;Writing the specs&lt;/h3&gt;
&lt;p&gt;The specs are written in Markdown.
Each spec file starts with a title and is underlined with &lt;code class=&quot;highlighter-rouge&quot;&gt;===&lt;/code&gt;.
Next, some steps can be defined that will be run before each scenario.
When listing steps, you need to prefix each step with an asterix (*) as in a Markdown list.
After that, the actual scenarios can be written.
They start with a title and are underlined with &lt;code class=&quot;highlighter-rouge&quot;&gt;---&lt;/code&gt;.
Again, the steps for a scenario should be listed as in a Markdown list.
You can also add some tags which can be used to only run certain specs and to search in the HTML reports.
Here’s an example specification:&lt;/p&gt;

&lt;div class=&quot;language-markdown highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gu&quot;&gt;Customer sign-up
================
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;
*&lt;/span&gt; Go to sign up page

&lt;span class=&quot;gh&quot;&gt;Customer sign-up
----------------
&lt;/span&gt;tags: sign-up, customer
&lt;span class=&quot;p&quot;&gt;
*&lt;/span&gt; Sign up a new customer with name &quot;JWorks&quot; email &quot;jworks@ordina.be&quot; and &quot;password&quot;
&lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; Check if the sign up was successful
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;writing-the-steps&quot;&gt;Writing the steps&lt;/h3&gt;
&lt;p&gt;The sentences we wrote in the specs still need to be linked to Java functions.
We can do so by simply adding a &lt;code class=&quot;highlighter-rouge&quot;&gt;@Step&lt;/code&gt; annotation to a Java function.
It doesn’t matter in which class you put the functions, you’re free to choose how to organize them.
As long as they are under the &lt;code class=&quot;highlighter-rouge&quot;&gt;src/test/java&lt;/code&gt; folder.
You could, for example, group them per page or feature.&lt;/p&gt;

&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CustomerSignup&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Step&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sign up as &amp;lt;customer&amp;gt; with email &amp;lt;customer@example.com&amp;gt; and &amp;lt;password&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;registerCustomerWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;customer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;WebDriver&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;webDriver&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Driver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;webDriver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;WebElement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;webDriver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;new_user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user[username]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;customer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user[email]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user[password]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user[password_confirmation]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;commit&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;click&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Step&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Check if the sign up was successful&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;checkSignUpSuccessful&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;WebDriver&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;webDriver&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Driver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;webDriver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;WebElement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;webDriver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElements&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;className&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;You have been signed up successfully!&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As shown in the example above, you can easily pass parameters to steps.
You simply have to wrap the keywords in &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;&amp;gt;&lt;/code&gt; in the &lt;code class=&quot;highlighter-rouge&quot;&gt;@Step&lt;/code&gt; annotation
and list the same keywords as parameters in the actual Java function.
Obviously, you can then use them in your Java code.&lt;/p&gt;

&lt;h3 id=&quot;page-object-pattern&quot;&gt;Page object pattern&lt;/h3&gt;
&lt;p&gt;A clean way to organize all your code would be to use the page object pattern.
This means that for every page in your web app, you should create a class.
Such a class contains all code to interact with that specific page.&lt;/p&gt;

&lt;p&gt;The example we saw earlier, could be transformed into this:&lt;/p&gt;

&lt;p&gt;Page object:&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SignUpPage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebElement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;usernameField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebElement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;emailField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebElement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;passwordField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebElement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;passwordConfirmField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;WebElement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;commitButton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;SignUpPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;WebDriver&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;webDriver&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Driver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;webDriver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;WebElement&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;webDriver&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;new_user&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;usernameField&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user[username]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;emailField&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user[email]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;passwordField&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user[password]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;passwordConfirmField&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;user[password_confirmation]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;commitButton&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;form&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;findElement&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;By&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;commit&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Step definition:&lt;/p&gt;
&lt;div class=&quot;language-java highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;CustomerSignup&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SignUpPage&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;signUpPage&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SignUpPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Step&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sign up as &amp;lt;customer&amp;gt; with email &amp;lt;customer@example.com&amp;gt; and &amp;lt;password&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;registerCustomerWith&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;customer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;signUpPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;usernameField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;customer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;signUpPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;emailField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;email&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;signUpPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;passwordField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;signUpPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;passwordConfirmField&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendKeys&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;signUpPage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;commitButton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;click&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The great benefit of this approach is that you can reuse a lot of the code.
You only have to locate the elements once instead of in every step.
Functions can be added to the page objects as well.
Suppose you have a dropdown, you first have to click to open it and then select an option from the list.
You can write a function doing all that.
In your step definition, you then simply have to call that function to select something from a dropdown.
It’s a good way to avoid too much code duplication.&lt;/p&gt;

&lt;h3 id=&quot;concepts&quot;&gt;Concepts&lt;/h3&gt;
&lt;p&gt;If you find yourself repeating the same sequence of steps over and over,
you could combine those steps into one step using concepts.
These are also written in Markdown and you can pass arguments the same way as in the Java &lt;code class=&quot;highlighter-rouge&quot;&gt;@Step&lt;/code&gt; annotations.
They should be placed in the &lt;code class=&quot;highlighter-rouge&quot;&gt;/specs/concepts&lt;/code&gt; folder and use the *.cpt extension.&lt;/p&gt;

&lt;div class=&quot;language-markdown highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;gh&quot;&gt;# Sign up a new customer with name &amp;lt;name&amp;gt; email &amp;lt;email&amp;gt; and &amp;lt;password&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; Sign up as &lt;span class=&quot;nt&quot;&gt;&amp;lt;name&amp;gt;&lt;/span&gt; with email &lt;span class=&quot;nt&quot;&gt;&amp;lt;email&amp;gt;&lt;/span&gt; and &lt;span class=&quot;nt&quot;&gt;&amp;lt;password&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; Show a message &quot;Thank you for signing up! You are now logged in.&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Cucumber only offers this feature in some implementations, they don’t in Cucumber.js for example.
They refuse to implement it because they believe this creates too much abstraction and makes you lose sight of the overall picture.
Gauge does offer it, so it’s up to you whether you want to make use of it or not.&lt;/p&gt;

&lt;h1 id=&quot;running-the-specs&quot;&gt;Running the specs&lt;/h1&gt;
&lt;p&gt;Since the project is setup with Maven, the tests can be run with &lt;code class=&quot;highlighter-rouge&quot;&gt;mvn test&lt;/code&gt;.
However, if you want to pass any arguments, you’ll need to use &lt;code class=&quot;highlighter-rouge&quot;&gt;mvn gauge:execute&lt;/code&gt; instead.&lt;/p&gt;

&lt;h3 id=&quot;tags&quot;&gt;Tags&lt;/h3&gt;

&lt;p&gt;You may have noticed in the spec files that tags can be added.
They can be used to run only certain specs.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mvn gauge:execute -DspecsDir=specs -Dtags=&quot;sign-up &amp;amp; customer&quot;&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;parallel&quot;&gt;Parallel&lt;/h3&gt;
&lt;p&gt;So far, Gauge didn’t stand out from other automated testing solutions.
Although there’s one thing that really does stand out and that’s how easy it is to use parallel execution!&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mvn gauge:execute -DspecsDir=specs -DinParallel=true&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Running this command will start up a stream for each CPU core your computer has.
For each stream it will open a browser window and execute the specs.
So if you have four CPU cores, four browser windows will be opened.
You can overwrite the number of parallel executors, but it’s recommended not to exceed the number of CPU cores.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mvn gauge:execute -DspecsDir=specs -DinParallel=true -Dnodes=2&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Now, some specs may take longer to run than others.
By default, specs are divided dynamically over the streams.
So when a spec has finished, it will take the next one from the list of specs that still need to be executed.
It’s possible to change this so the specs are divided on startup, but the command is deprecated and will be removed.&lt;/p&gt;

&lt;h3 id=&quot;making-tests-independent&quot;&gt;Making tests independent&lt;/h3&gt;
&lt;p&gt;To make use of this parallel execution, you’ll have to make sure that your tests don’t rely on each other.
I think it’s pretty clear why you shouldn’t do that.
Anyway, suppose you test the sign up and sign in.
If your sign in relies on the user being signed up through a previous test, these tests should be run synchronously.
However, if you would want to test whether a user can sign in after having signed up, you should do so in one test.
That immediately solves our problem and we are safe to use the parallel execution!&lt;/p&gt;

&lt;h1 id=&quot;environments-and-configuration&quot;&gt;Environments and configuration&lt;/h1&gt;
&lt;p&gt;The config files are located under &lt;code class=&quot;highlighter-rouge&quot;&gt;env/default&lt;/code&gt;.
You should have three files in that folder: &lt;code class=&quot;highlighter-rouge&quot;&gt;default.properties&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;java.properties&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;user.properties&lt;/code&gt;.
In the &lt;a href=&quot;https://github.com/getgauge-examples/java-maven-selenium&quot; target=&quot;_blank&quot;&gt;example by Gauge&lt;/a&gt;, they have an &lt;code class=&quot;highlighter-rouge&quot;&gt;APP_URL&lt;/code&gt; parameter in that last file.
I recommend using that approach as well, you can get parameters in your Java code using &lt;code class=&quot;highlighter-rouge&quot;&gt;System.getenv(&quot;APP_URL&quot;)&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;It’s possible to create different environments by simply creating a new folder.
There you can add &lt;code class=&quot;highlighter-rouge&quot;&gt;*.properties&lt;/code&gt; files containing additional properties or properties overwriting the ones in the default folder.
So, that means you don’t need to copy the whole configuration. 
Gauge will always load all the default properties. 
Then it will load those defined for the environment you wish to use. 
If a property is defined for an environment and it already exists in the default configuration, it will use the one defined for that environment instead.
Now, suppose you want a different configuration for your CI-tool, you can create a folder named &lt;code class=&quot;highlighter-rouge&quot;&gt;ci&lt;/code&gt;.
When running the specs, simply pass an argument stating the environment.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;mvn gauge:execute -Denv=&quot;ci&quot;&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Environments can also be used to run gauge with another browser like in the &lt;a href=&quot;https://github.com/getgauge-examples/java-maven-selenium&quot; target=&quot;_blank&quot;&gt;example by Gauge&lt;/a&gt;.
Create a folder named &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox&lt;/code&gt; for example and add a file called &lt;code class=&quot;highlighter-rouge&quot;&gt;browser.properties&lt;/code&gt;.
In that file you add &lt;code class=&quot;highlighter-rouge&quot;&gt;browser = FIREFOX&lt;/code&gt;.
When you then run the tests with the &lt;code class=&quot;highlighter-rouge&quot;&gt;firefox&lt;/code&gt; environment, it will use FireFox as a browser instead.
(This only works if you have your project set up like in the example, the &lt;a href=&quot;https://github.com/getgauge-examples/java-maven-selenium/tree/master/src/test/java/utils/driver&quot; target=&quot;_blank&quot;&gt;Driver&lt;/a&gt; and &lt;a href=&quot;https://github.com/getgauge-examples/java-maven-selenium/tree/master/src/test/java/utils/driver&quot; target=&quot;_blank&quot;&gt;DriverFactory&lt;/a&gt; files are required here.)&lt;/p&gt;

&lt;h1 id=&quot;reports&quot;&gt;Reports&lt;/h1&gt;
&lt;p&gt;To get a HTML report, the plugin has to be installed first: &lt;code class=&quot;highlighter-rouge&quot;&gt;gauge install html-report&lt;/code&gt;.
That’s about it!
After running the specs, a nice HTML report will be outputted to the &lt;code class=&quot;highlighter-rouge&quot;&gt;/reports&lt;/code&gt; folder.
It shows which tests succeeded and which failed with some additional graphs.
In the report you’ll even find how long it took to run a test and each of its steps.
There’s also a search functionality to quickly find a certain spec.&lt;/p&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; alt=&quot;Gauge HTML report&quot; src=&quot;/img/2018-01-05-gauge-automated-testing/gauge-report.jpg&quot; /&gt;
&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;It’s a good idea to write automated tests.
If you do it well, you don’t have to spend a lot of time manually testing your application.
The chance of something being broken by your changes will decrease dramatically.
Also, be sure to use the page object pattern and create functions for repetitive actions.
It avoids code duplication and having to update the same code in multiple places.&lt;/p&gt;

&lt;p&gt;If you’re starting a new project or starting from scratch with writing browser tests, you should consider using Gauge.
Even though it’s still in beta.
With ThoughtWorks as the main force behind this tool, it’s here to stay!&lt;/p&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Martijn&quot;, &quot;last_name&quot;=&gt;&quot;Willekens&quot;, &quot;linkedin&quot;=&gt;&quot;mwillekens&quot;, &quot;permalink&quot;=&gt;&quot;/author/martijn-willekens/&quot;, &quot;avatar&quot;=&gt;&quot;martijn-willekens.jpg&quot;, &quot;title&quot;=&gt;&quot;Frontend developer&quot;, &quot;email&quot;=&gt;&quot;martijn.willekens@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Martijn is a frontend developer at Ordina Belgium. He primarily devotes himself to building Angular and Ionic apps written in TypeScript. ReactiveX is his favorite set of tools to work with.&quot;}</name><email>martijn.willekens@ordina.be</email></author><category term="Testing" /><category term="Gauge" /><category term="E2E" /><category term="End to end" /><category term="Testing" /><category term="Test automation" /><category term="Automation" /><summary type="html">After finishing a new feature in your web app, you test whether it works. However, while working on that new feature, you may have broken something else. If you want to know for sure, you have to test everything. Clicking around, filling in forms, … will cost you some valuable time. So, you’ll probably end up not doing it thorough enough or even not at all, assuming everything else still works fine. That’s exactly why you should have automated tests do it for you!</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/2018-01-05-gauge-automated-testing/gauge.png" /></entry><entry><title type="html">3 Stages of API testing</title><link href="https://ordina-jworks.github.io/testing/2018/01/04/3-stages-api-testing.html" rel="alternate" type="text/html" title="3 Stages of API testing" /><published>2018-01-04T00:00:00+00:00</published><updated>2018-01-04T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/testing/2018/01/04/3-stages-api-testing</id><content type="html" xml:base="https://ordina-jworks.github.io/testing/2018/01/04/3-stages-api-testing.html">&lt;blockquote&gt;
  &lt;p&gt;Continuous Integration with automated testing is more and more incorporated in the culture of software delivery companies.
Running tests in different stages is a big part of it.
In this post, we’ll have a look at our three stages of API testing we are promoting at Ordina.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;table-of-contents&quot;&gt;Table of contents&lt;/h1&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;a href=&quot;#setup&quot;&gt;About the setup&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#stage-1-unit-testing-the-communication-layer-front-and-back-end&quot;&gt;Stage 1: Unit testing&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#stage-2-testing-against-a-mock-end&quot;&gt;Stage 2: Testing against a mock-end&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#stage-3-testing-full-environment&quot;&gt;Stage 3: Testing full environment&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#conclusion&quot;&gt;Conclusion&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;setup&quot;&gt;Setup&lt;/h1&gt;

&lt;p&gt;The example we are going to use is part of a bigger microfrontend/microservice setup.
The front-end part of this example is the actual header of this microfrontend setup. It’s the top bar, developed as a separate front-end application.
This header provides the user with a search input field, where the user can search our database of competence centers.
This part is written in Angular (5).
The app gets dockerized after the unit tests (and build) are successfully completed.
It is served by a simple Express server inside a Docker container.
The back-end part provides the data of the competence centers.
It’s nothing more than a simple REST API written in TypeScript using the Nest.js framework.
The data provided by this service is a JSON file.
Its content is parsed into memory and is exposed through this REST API.&lt;/p&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:575px;&quot; alt=&quot;Easy client server setup&quot; src=&quot;/img/3-stages-api-testing/setup.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;The front-end (header) is providing the user with an input field.
This field allows the user to perform a search on our back-end service.
It also provides a &lt;code class=&quot;highlighter-rouge&quot;&gt;clear&lt;/code&gt; button, so the user can remove the content from the input field and reset the local cache of search results.
A second button is the &lt;code class=&quot;highlighter-rouge&quot;&gt;filter&lt;/code&gt; button.
When pressed, it will emit an event that can be listened to by other microfrontends.&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filterCCs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;isPlatformBrowser&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;platformId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;CustomEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'filterCCs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;detail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;needle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;needle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;dispatchEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filterStats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;needle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_updateData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_updateData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_ccService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getStats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;needle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kr&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;resetSearch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;needle&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When resetting the content with the &lt;code class=&quot;highlighter-rouge&quot;&gt;clear&lt;/code&gt; button, we’re not sending a request.
When there’s nothing to search for, the result would be an empty array.
So we’re just resetting our local data to an empty array.&lt;/p&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:925px;&quot; alt=&quot;Easy client server setup&quot; src=&quot;/img/3-stages-api-testing/header.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;The back-end API is exposing three endpoints:&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getAllCCs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ccs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_ccsService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getAllCCs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ccs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/search'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;searchCCs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Query&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'needle'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;searchString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;filtered&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_ccsService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;searchCCs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;searchString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;filtered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/:id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;getCC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;Param&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cc&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;_ccsService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getCC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HttpStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The header will always trigger the endpoint at &lt;code class=&quot;highlighter-rouge&quot;&gt;search&lt;/code&gt; with a needle.
When the needle is undefined (or an empty string), the search endpoint will return an empty list.&lt;/p&gt;

&lt;h1 id=&quot;stage-1-unit-testing-the-communication-layer-front-and-back-end&quot;&gt;Stage 1: Unit testing the communication layer (front and back-end)&lt;/h1&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:575px;&quot; alt=&quot;decoupled&quot; src=&quot;/img/3-stages-api-testing/unit.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;The first stage is unit testing each component. This step is almost always part of the component’s build. Let’s take a quick look at each component.&lt;/p&gt;

&lt;h3 id=&quot;unit-testing-the-communication-part-of-the-ui&quot;&gt;Unit testing the communication part of the UI&lt;/h3&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:325px;&quot; alt=&quot;Easy client server setup&quot; src=&quot;/img/3-stages-api-testing/unit-client.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;For unit testing our front-end Angular 5 application, we are going to use the &lt;code class=&quot;highlighter-rouge&quot;&gt;import { MockBackend } from '@angular/http/testing';&lt;/code&gt; from Angular itself to mock our back-end.&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;TestBed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;configureTestingModule&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;na&quot;&gt;providers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;CCService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// our service that is handling the communication&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;provide&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XHRBackend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;useClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;MockBackend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// our mock&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;compileComponents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}));&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Should query ccs with an observable'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Should return data'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;inject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CCService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;XHRBackend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ccService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;mockBackend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;mockBackend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;connections&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;ccs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
          &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mockRespond&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ResponseOptions&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
          &lt;span class=&quot;na&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ccs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;})));&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;ccService&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getStats&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'tim'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ccs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ccs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ccs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clEmail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'tim.vierbergen@ordina.be'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
       &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Angular framework handles the communication part.
We want to mock the &lt;code class=&quot;highlighter-rouge&quot;&gt;$http&lt;/code&gt; call and see how we are handling the result.
The &lt;code class=&quot;highlighter-rouge&quot;&gt;mockBackend&lt;/code&gt; is working inbetween our own code and the provided &lt;code class=&quot;highlighter-rouge&quot;&gt;$http&lt;/code&gt; part.
Every call is triggering the &lt;code class=&quot;highlighter-rouge&quot;&gt;mockBackend.connections&lt;/code&gt;, so the subscribers are triggered.
We are providing our own data and returning it as the response of the &lt;code class=&quot;highlighter-rouge&quot;&gt;$http&lt;/code&gt; call.&lt;/p&gt;

&lt;h3 id=&quot;unit-testing-the-communication-layer-of-the-service&quot;&gt;Unit testing the communication layer of the service&lt;/h3&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:325px&quot; alt=&quot;Easy client server setup&quot; src=&quot;/img/3-stages-api-testing/unit-service.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;For unit testing our back-end, we are using Jest.
&lt;a href=&quot;https://facebook.github.io/jest/&quot; target=&quot;_blank&quot;&gt;Jest&lt;/a&gt; is a testing framework by Facebook.
If you are interested in Jest, make sure to watch this blog, as a post around this topic is in the making.
Just as with our front-end, we trust the framework to correctly handle the communication itself.&lt;/p&gt;

&lt;p&gt;Our unit tests will start at the controller level of our API.&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'searchCCs'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'should return a filtered array of competence centers'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;kr&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;ccsController&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;searchCCs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mockResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'tim'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;kd&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;mockResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;clEmail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'tim.vierbergen@ordina.be'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Where mockResponse is exactly that.
A simple mock of the response object.&lt;/p&gt;

&lt;h3 id=&quot;purpose-of-these-unit-tests&quot;&gt;Purpose of these unit tests&lt;/h3&gt;

&lt;p&gt;The goal of these unit tests is to make sure that the functions inside the components are working as expected.
This way the next stage of testing can only fail due to errors from outside this component.
However, to make sure this is the case, the mock data should be as close to production data when it comes to data specific characteristics.
This is more important for your front-end because you have less control over the data itself.
Your back-end API is only responding to request params that are defined in the specs.
So it’s easier to control them, or ignore unknowns.&lt;/p&gt;

&lt;h1 id=&quot;stage-2-testing-against-a-mock-end&quot;&gt;Stage 2: Testing against a mock-end&lt;/h1&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:575px&quot; alt=&quot;Easy client server setup&quot; src=&quot;/img/3-stages-api-testing/mock-end.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;In our second stage we are going to use a mock service to test against.
This means that we are going to mock ‘the other’ component by replacing it with an easy to use solution.
Although we are mocking some parts, this can be seen as an end-to-end test for each component itself.
We want to test our component by means of external services, just as it is supposed to work in a complete environment.&lt;/p&gt;

&lt;h3 id=&quot;mocking-our-back-end-to-test-our-front-end&quot;&gt;Mocking our back-end to test our front-end.&lt;/h3&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:575px&quot; alt=&quot;Mocking the back-end&quot; src=&quot;/img/3-stages-api-testing/front-end-mock.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;For our front-end component (user interface), we are going to mock the back-end.
Some front-ends are performing calls even without human interaction.
However, in most cases, front-end communication is depending on human interaction.
To end-to-end test this part, we are also in need of a framework to mock this user interaction.
&lt;a href=&quot;https://getgauge.io/&quot; target=&quot;_blank&quot;&gt;Gauge&lt;/a&gt;, &lt;a href=&quot;http://www.protractortest.org/&quot; target=&quot;_blank&quot;&gt;Protractor&lt;/a&gt; and &lt;a href=&quot;http://nightwatchjs.org/&quot; target=&quot;_blank&quot;&gt;Nightwatch.js&lt;/a&gt; are some examples of these frameworks.
Most of them depend on ‘Selenium WebDriver’.&lt;/p&gt;

&lt;h4 id=&quot;node-red-for-back-end-mocking&quot;&gt;Node-RED for back-end mocking&lt;/h4&gt;

&lt;p&gt;We are using Node-RED for our back-end mock because it’s so easy to setup and dockerize.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;a href=&quot;https://nodered.org&quot; target=&quot;_blank&quot;&gt;Node-RED&lt;/a&gt; is a programming tool for wiring together hardware devices, APIs and online services in new and interesting ways.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Node-RED is much more than just a tool to mock a back-end or any other service.
It comes with a great User Interface to define your flows and to deploy them on your server.&lt;/p&gt;

&lt;p&gt;For this example we will mock our three endpoints and return test data.
This test data can come from different sources.
Node-RED provides multiple ways of working with data.
You can include a simple MongoDB in your setup and read (even write) data from it.
Or you can just use functions where you hard code your data.
To keep it simple, we will use the latter in our setup.&lt;/p&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:875px&quot; alt=&quot;Mocking the back-end&quot; src=&quot;/img/3-stages-api-testing/node-red-flow.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;A simple mock for a http-call consists out of three parts:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The entry point definition itself (input)&lt;/li&gt;
  &lt;li&gt;The function that handles the data (can be static or database or …)&lt;/li&gt;
  &lt;li&gt;The response definition&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:425px;&quot; alt=&quot;Data function config&quot; src=&quot;/img/3-stages-api-testing/node-red-data.png&quot; /&gt;
&lt;/p&gt;

&lt;h4 id=&quot;user-interface-automation&quot;&gt;User interface automation&lt;/h4&gt;

&lt;p&gt;In this setup we are using Protractor for the e2e tests.
The user input is limited to an input field to trigger the search REST-call and two buttons, one button for clearing the input and one for sending the search string to other microfrontend components.&lt;/p&gt;

&lt;p&gt;Some of the use cases, such as ‘clearing’ the input, are already covered in the unit tests.
Depending on the effort you can always retest them in these e2e tests, but for this example, those are not important.
We want to trigger the search REST call by sending the search string &lt;code class=&quot;highlighter-rouge&quot;&gt;tim&lt;/code&gt; to the input field, and testing the outcome in the user interface.&lt;/p&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:925px;&quot; alt=&quot;Data function config&quot; src=&quot;/img/3-stages-api-testing/search-e2e.png&quot; /&gt;
&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Searching with Tim should show 2 results'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;setSeachText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'mySearchString'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Input field should contain 'tim'&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getSearchText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'tim'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Result should show 2 entries&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    	    &lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;will show the number 2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getResultNumber&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;will show a dropdown with 2 results&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;nx&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;page&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;getResultList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;toBe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
            &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;conclusion-for-our-front-end&quot;&gt;Conclusion for our front-end&lt;/h4&gt;

&lt;p&gt;This mock e2e test is depending on a mock back-end and a user input automation system.
We are running these tests on our &lt;a href=&quot;https://www.gocd.org/&quot; target=&quot;_blank&quot;&gt;GoCD&lt;/a&gt; setup with dockerized elastic agents.
To run these tests, we are in need of a go-agent that can run these e2e test with Protractor, but we also need an environment where we can serve this front-end and the mocked service.
We are doing this with a go-agent that first spins up a docker-compose (for our front-end and mock-end), runs the protractor tests to this new environment and then brings down the environment when tests are finished.&lt;/p&gt;

&lt;h3 id=&quot;mocking-our-front-end-to-test-our-back-end&quot;&gt;Mocking our front-end to test our back-end.&lt;/h3&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:500px;&quot; alt=&quot;Mocking the back-end&quot; src=&quot;/img/3-stages-api-testing/back-end-mock.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;For testing our back-end service, we only need one other service.
This service will need to fire REST calls to our back-end service and analyse the response.
We can use &lt;a href=&quot;https://www.getpostman.com/&quot; target=&quot;_blank&quot;&gt;Postman&lt;/a&gt; to set this up.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Postman is the complete toolchain for API developers, used by more than 3 million developers and 30000 companies worldwide.
Postman makes working with APIs faster and easier by supporting developers at every stage of their workflow.
It’s available for Mac OS X, Windows, Linux and Chrome users.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;You can use Postman for more than just API testing.
In our setup, we need to create a testing scenario and just run it against our back-end service.
Postman provides a user interface to do so.
However, because we are running our tests on a cloud elastic go-agent, we need to find a way to automate this step.
Luckily, Postman also provides a command-line tool called &lt;a href=&quot;https://github.com/postmanlabs/newman&quot; target=&quot;_blank&quot;&gt;Newman&lt;/a&gt;.
Newman let’s you run your test scenarios from your command line.
You can first configure everything through the user interface and then just export the scenario so you can use it through the CLI.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;You can read more about Postman and Newman in our blogpost &lt;a href=&quot;https://ordina-jworks.github.io/testing/2016/09/16/Automation-testing-with-postman.html&quot; target=&quot;_blank&quot;&gt;API Testing with Postman and Newman&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Below, you can find a part of the exported JSON configuration.
This part will send a GET request to the search endpoint, providing the search string &lt;code class=&quot;highlighter-rouge&quot;&gt;tim&lt;/code&gt;.
It will then analyse the response and check if the resulting array contains 2 entries and verifies the data.&lt;/p&gt;

&lt;div class=&quot;language-javascript highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Search existing ccs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;event&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;s2&quot;&gt;&quot;listen&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
			&lt;span class=&quot;s2&quot;&gt;&quot;script&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;s2&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
				&lt;span class=&quot;s2&quot;&gt;&quot;exec&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;var jsonData = JSON.parse(responseBody);&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;var firstResult = jsonData[0];&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;tests[&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Status code is 200&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;] = responseCode.code === 200;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;tests[&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;4 results returned&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;] = jsonData.length === 2;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;tests[&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;First result contains id &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;] ='id' in firstResult;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;tests[&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Cl name contains tim vierbergen&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;] = firstResult.cl === &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Tim Vierbergen&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;;&quot;&lt;/span&gt;
				&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;request&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;s2&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;s2&quot;&gt;&quot;raw&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;:/ccs/search?needle=tim&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
			&lt;span class=&quot;s2&quot;&gt;&quot;host&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
				&lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
			&lt;span class=&quot;s2&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
			&lt;span class=&quot;s2&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
				&lt;span class=&quot;s2&quot;&gt;&quot;ccs&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
				&lt;span class=&quot;s2&quot;&gt;&quot;search&quot;&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
			&lt;span class=&quot;s2&quot;&gt;&quot;query&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
				&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;needle&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;tim&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;equals&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
					&lt;span class=&quot;s2&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
				&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
			&lt;span class=&quot;s2&quot;&gt;&quot;variable&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
		&lt;span class=&quot;s2&quot;&gt;&quot;method&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;GET&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;s2&quot;&gt;&quot;header&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
				&lt;span class=&quot;s2&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
				&lt;span class=&quot;s2&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;application/json&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
				&lt;span class=&quot;s2&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
			&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
		&lt;span class=&quot;s2&quot;&gt;&quot;body&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{},&lt;/span&gt;
		&lt;span class=&quot;s2&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;response&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;        
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In our continuous integration system, we are running these tests on a simple go-agent that can run these Newman tests.
This agent spins up our service container, runs these tests and bring down that container.&lt;/p&gt;

&lt;h4 id=&quot;conclusion-for-our-back-end&quot;&gt;Conclusion for our back-end&lt;/h4&gt;

&lt;p&gt;Testing this back-end service with a mock front-end is pretty easy.
Since our data is included in this service and it is limited to a simple JSON file, we are not running performance tests.
However, when your back-end needs to communicate with a database and/or make calculations, you can and should already include some performance tests in this stage.
You can, for example, include some &lt;a href=&quot;https://gatling.io/&quot; target=&quot;_blank&quot;&gt;Gatling&lt;/a&gt; tests in this stage and put some load on this service to check response times.&lt;/p&gt;

&lt;p&gt;The goal of this stage is to test the whole component, including the frameworks we are using for the communication.
It is still a decoupled system.
Failures in this stage will show you that some integrations are failing and you know exactly where to look for the errors.&lt;/p&gt;

&lt;h1 id=&quot;stage-3-testing-full-environment&quot;&gt;Stage 3: Testing full environment&lt;/h1&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:575px;&quot; alt=&quot;No more mocking&quot; src=&quot;/img/3-stages-api-testing/full-env.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;We now want to end-to-end test the whole system.
We can use docker-compose to spin up this environment and then again run tests against the user interface.
It will communicate with the real back-end to query its data and show the results in the user interface.
Again, we want to run those tests on an elastic go-agent, so we are in need of an automated system.
Right, we already used this in the previous stage where we were testing the user interface against a mocked back-end.&lt;/p&gt;

&lt;p&gt;
    &lt;img class=&quot;image fit&quot; style=&quot;margin:0px auto; max-width:575px;&quot; alt=&quot;No more mocking&quot; src=&quot;/img/3-stages-api-testing/full-env-ui.png&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;This elastic go-agent must be able to run the Protractor tests (obviously). It will first need to spin up this environment, run the tests and tear down the environment. Same goes for performance tests in this stage.
You can use some frameworks to put extra load on your front-end to see how it’s behaving when it needs to handle more REST-calls for different parts.
Or you can run more instances of the user interface, resulting in more load on the back-end service.&lt;/p&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;Decoupling your system and running tests in different stages will make it easier to debug when something is going wrong.
Finding errors earlier will also save you some time and resources.
Being able to find bugs before taking it to the next stage and spinning up complete environments will reduce the cost of your system (cloud).&lt;/p&gt;

&lt;p&gt;Yes, writing tests can be more expensive in time and resources in the short run, but it will save you a lot more time and resources in the long run.&lt;/p&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Tim&quot;, &quot;last_name&quot;=&gt;&quot;Vierbergen&quot;, &quot;permalink&quot;=&gt;&quot;/author/tim-vierbergen/&quot;, &quot;avatar&quot;=&gt;&quot;tim-vierbergen.jpg&quot;, &quot;twitter&quot;=&gt;&quot;vierbergentim&quot;, &quot;linkedin&quot;=&gt;&quot;tim-vierbergen-82557834&quot;, &quot;github&quot;=&gt;&quot;VeeTeeDev&quot;, &quot;title&quot;=&gt;&quot;Software Engineer&quot;, &quot;title2&quot;=&gt;&quot;Principal Consultant &amp; Competence Lead CI/CD&quot;, &quot;email&quot;=&gt;&quot;tim.vierbergen@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Tim is a senior developer and architect at Jworks Ordina Belgium. Tim has a DevOps culture mindset and is experienced in many different domains. From frontend to backend to pipelining and automation. Tim is keen on learning new technologies.&lt;br /&gt;&lt;br /&gt;Tim is a true sportsman and spends part of his free time running and working out. Tim is also very passionate about surfing and is learing how to snowboard.&quot;}</name><email>tim.vierbergen@ordina.be</email></author><category term="Testing" /><category term="Node-RED" /><category term="angular" /><category term="nestjs" /><category term="jest" /><category term="GoCD" /><category term="docker" /><category term="ci" /><summary type="html">Continuous Integration with automated testing is more and more incorporated in the culture of software delivery companies. Running tests in different stages is a big part of it. In this post, we’ll have a look at our three stages of API testing we are promoting at Ordina.</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/3-stages-api-testing/overview.png" /></entry><entry><title type="html">JSConf Budapest 2017 Day 2</title><link href="https://ordina-jworks.github.io/conference/2018/01/03/JS-Conf-Budapest-day-2.html" rel="alternate" type="text/html" title="JSConf Budapest 2017 Day 2" /><published>2018-01-03T00:00:00+00:00</published><updated>2018-01-03T00:00:00+00:00</updated><id>https://ordina-jworks.github.io/conference/2018/01/03/JS-Conf-Budapest-day-2</id><content type="html" xml:base="https://ordina-jworks.github.io/conference/2018/01/03/JS-Conf-Budapest-day-2.html">&lt;h2 id=&quot;from-jsconf-budapest-with-love&quot;&gt;From JSConf Budapest with love&lt;/h2&gt;

&lt;p&gt;This year’s edition of JS Conf Budapest returned to the first venue at &lt;a href=&quot;http://www.urania-nf.hu/&quot;&gt;Urania National Movie theater&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Uránia Cinema in the middle of the city, near the party-district.
Designed by Henrik Schmahl in the late 1890’s, the interior is characterized by the ornamental motifs of the Venetian Gothic and Moor styles.
The place is listed as the world’s 3rd most beautiful cinema on Bored Panda.
Many tech conferences were hosted here recently, such as TEDx and Strech Conference, because of the unique atmosphere.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;JS Conf Budapest 2017 is hosted by &lt;a href=&quot;https://twitter.com/glenmaddern&quot;&gt;Glen Maddern&lt;/a&gt; and &lt;a href=&quot;https://twitter.com/superhighfives&quot;&gt;Charlie Gleason&lt;/a&gt;.
At 10:00 the second day of the conference started. Enough time to drink great coffee and enjoy the breakfast.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img class=&quot;image fit&quot; src=&quot;/img/js-conf-budapest-2017/js-conf-budapest-2017-collage.jpg&quot; alt=&quot;JS Conf Budapest 2017 Photo Collage&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;day-2-talks&quot;&gt;Day 2: Talks&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#don-burks-mvc---what-a-web-app-and-a-mozart-violin-concerto-have-in-common&quot;&gt;Don Burks: MVC - What a web app and a Mozart Violin Concerto have in common&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#opher-vishnia-web-animation-from-disney-to-sass&quot;&gt;Opher Vishnia: Web Animation: from Disney to SASS&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#imad-elyafi-migrating-pinterest-profiles-to-react&quot;&gt;Imad Elyafi: Migrating Pinterest profiles to React&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#laura-carvajal-yes-your-site-can-and-should-be-accessible-too-lessons-learned-in-building-ftcom&quot;&gt;Laura Carvajal: YES, your site can (and should) be accessible too. Lessons learned in building FT.com&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#nikita-baksalyar-exploring-the-p2p-world-with-webrtc--javascript&quot;&gt;Nikita Baksalyar: Exploring the P2P world with WebRTC &amp;amp; JavaScript&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#vaidehi-joshi-goldilocks-and-the-three-code-reviews&quot;&gt;Vaidehi Joshi: Goldilocks And The Three Code Reviews&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;day-2-morning&quot;&gt;Day 2: Morning&lt;/h2&gt;

&lt;p&gt;&lt;span class=&quot;image left&quot;&gt;&lt;img class=&quot;p-image&quot; alt=&quot;Don Burks&quot; src=&quot;/img/js-conf-budapest-2017/speaker-don.jpg&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;don-burks-mvc---what-a-web-app-and-a-mozart-violin-concerto-have-in-common&quot;&gt;Don Burks: MVC - What a web app and a Mozart Violin Concerto have in common&lt;/h3&gt;

&lt;p&gt;You can find him on Twitter using the handle &lt;a href=&quot;https://twitter.com/don_burks&quot;&gt;@don_burks&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The presentation can be found &lt;a href=&quot;https://donburks.com/2017-10-27-jsconfbp-presentation/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
Composers and developers of applications have more in common than you might think. In his talk, Don Burks pointed out the similarities in structure between music and apps.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;An app has a certain structure, being the architecture or the configuration of how all the different components interact with each other. 
The same applies to a composition, where the structure represents the different themes in the composition. 
When you look at an application, you see a system of databases, web servers, load balancers, etc. 
All these components are part of the system. Composers have the same vision on their composition.&lt;/p&gt;

&lt;p&gt;When creating the flow of an application, developers start from a certain point and move forward from one step to another, where each step describes an action or event in the app. 
These steps are like a melody in music that moves everything forward. 
Developers also think vertically to visualize the architecture of the application. 
All the technologies that are used, are represented in a vertical stack.&lt;/p&gt;

&lt;p&gt;The goal of the application is to deliver a complete package, where the horizontal problem-solving and the vertical architecture should be transparent to the user. 
In music it is important that every tune is played on time. 
The musician must deliver the right tune at the right time in order to create the music like the composer intended it to be. 
An app should run the same way: it has to deliver the right “tune” at the desired time to provide the best user experience.&lt;/p&gt;

&lt;p class=&quot;image&quot;&gt;&lt;img src=&quot;/img/js-conf-budapest-2017/don-burks-summary.png&quot; alt=&quot;Composing music is an art and so is coding&quot; width=&quot;100%&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The talk gave us more insight about various aspects in development, seen from a musician’s perspective. Composing music is an art and so is coding.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;opher-vishnia-web-animation-from-disney-to-sass&quot;&gt;Opher Vishnia: Web Animation: from Disney to SASS&lt;/h3&gt;

&lt;p&gt;&lt;span class=&quot;image left&quot;&gt;&lt;img class=&quot;p-image&quot; alt=&quot;Opher Vishnia&quot; src=&quot;/img/js-conf-budapest-2017/speaker-opher.jpg&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;You can find Opher on Twitter using the handle &lt;a href=&quot;https://twitter.com/opherv&quot;&gt;@opherv&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The presentation can be found &lt;a href=&quot;http://slides.com/opherv/jsconfbp2017/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
Opher is a designer and developer. In his talk, Opher shared his vision on how animations come to live.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;After we got introduced to Opher’s cute dog named &lt;em&gt;Blizzard&lt;/em&gt;, which grew up to a direwolf that can be casted directly in a TV show about dragons and an upcoming winter, Opher started his talk with some child nostalgia from Disney. He shared his amazement about the animations used in old animated movies such as &lt;em&gt;The Lion King&lt;/em&gt;, especially since they were hand drawn, and how these animation bring the characters and surroundings to life.&lt;/p&gt;

&lt;p&gt;Now, how do animations come to life? Two of the influencing factors are &lt;em&gt;Follow Through&lt;/em&gt; and &lt;em&gt;Overlapping Actions&lt;/em&gt;, which are part of the 12 basic principles of animation. The Follow Through principle defines that not every part of a moving entity moves the same way and stops the same way. Rather when one part of an entity stops, the other parts will follow through and come back. To illustrate this, Opher showed us an animation of a moving carrot that stopped suddenly, causing the leaves to go further before they stopped moving as well.&lt;/p&gt;

&lt;p&gt;The Overlapping Action principle means that when an entity is moving, its looser parts start moving later. The animation of the moving carrot clearly showed that the carrot itself moved in a smooth way, while the leaves were being dragged behind the carrot.&lt;/p&gt;

&lt;p&gt;These animation principles are applied by design specifications of huge companies such as the Material Design specs of Google. By taking these principles into account, you can give components and also the flow of your application more realism, for example when responding to events such as user input.&lt;/p&gt;

&lt;p&gt;Now, how can we implement these animations in our app? Opher discussed three implementations with us by means of an animation he has been working on:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;CSS&lt;/li&gt;
  &lt;li&gt;GSAP, GreenSock Animation Platform&lt;/li&gt;
  &lt;li&gt;WAAPI, Web Animation API&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;css&quot;&gt;CSS&lt;/h4&gt;
&lt;p&gt;With the CSS implementation, Opher’s animation performed well across different devices and was directly understood by the browser. However, he stumbled upon the limitations of CSS, which made it tricky to implement complex animations and dynamic animations were even a complete no-go. Besides that, debugging was not a joy.&lt;/p&gt;

&lt;h4 id=&quot;gsap&quot;&gt;GSAP&lt;/h4&gt;
&lt;p&gt;GSAP provides a great, robust API to implement animations and even dynamic animations. It also deals with inconsistencies of browsers, which makes the life of a developer easier. Unfortunately, there are some downsides too. One of them is that you depend on an extra lib. Additionally, the JavaScript where GSAP is based on is implementation-sensitive and more advanced features of GSAP are not free.&lt;/p&gt;

&lt;h4 id=&quot;waapi&quot;&gt;WAAPI&lt;/h4&gt;
&lt;p&gt;WAAPI provides a native JavaScript API for animations. Basically you query for the desired elements in JS and call the animation function of those elements where you configure the animation. The animate function accepts two parameters: the keyframes and the duration of the animation. The keyframes should be an array of objects, where each object defines the state of the object at a certain time. The second parameter can also be replaced by an options object which enables you to configure the animation way better, such as adding delays or repeating the animation infinitely. The downside is that WAAPI is not supported by many browsers, but there is nothing a good polyfill cannot fix.&lt;/p&gt;

&lt;p&gt;So, which one should you use in your next project? As for most situations, this depends on your specific requirements and your expertise with the different implementations. It is recommended to keep these principles in mind when implementing animations in the future. With a little effort you can bring your own app to life, just like the animators of Disney did in their fairy tales.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;imad-elyafi-migrating-pinterest-profiles-to-react&quot;&gt;Imad Elyafi: Migrating Pinterest profiles to React&lt;/h3&gt;

&lt;p&gt;&lt;span class=&quot;image left&quot;&gt;&lt;img class=&quot;p-image&quot; alt=&quot;Imad Elyafi&quot; src=&quot;/img/js-conf-budapest-2017/speaker-imad.jpg&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;You can find Imad on Twitter using the handle &lt;a href=&quot;https://twitter.com/eelyafi&quot;&gt;@eelyafi&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The presentation can be found &lt;a href=&quot;https://assets.contentful.com/nn534z2fqr9f/3RwYa1gv9SyQqsyscwws0A/be3e79ee3073cb973038395648bd249a/Imad_Elyafi_How_We_Migrated_Pinterest_Profiles_to_React.pdf&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A similar presentation was recorded on PolyConf 2017 and can be found on &lt;a href=&quot;https://www.youtube.com/watch?v=OtEsmImvYeo&quot;&gt;YouTube&lt;/a&gt;.
A detailed write-out of that presentation can be found on &lt;a href=&quot;https://medium.com/@Pinterest_Engineering/migrating-pinterest-profiles-to-react-479f4f7306aa&quot;&gt;Medium&lt;/a&gt;&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
Imad Elyafi is a software engineer at Pinterest. 
In this talk Imad tells you the story of how Pinterest migrated to React, explaining the techniques they tried and challenges they faced.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;With the current availability of fantastic modern frameworks, Pinterest decided to migrate from their outdated Denzel framework to React.&lt;/p&gt;

&lt;h5 id=&quot;why-react&quot;&gt;Why React?&lt;/h5&gt;
&lt;p&gt;Imad started off by saying they had a list of requirements for the new framework.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Large developer community&lt;/li&gt;
  &lt;li&gt;Design patterns that are compatible with the existing stack to make the migration easier&lt;/li&gt;
  &lt;li&gt;Isomorphic rendering, therefore being able to reuse templates on server- and client-side&lt;/li&gt;
  &lt;li&gt;Performance&lt;/li&gt;
  &lt;li&gt;Developer Experience&lt;/li&gt;
&lt;/ol&gt;

&lt;h5 id=&quot;road-to-react&quot;&gt;Road to React&lt;/h5&gt;
&lt;p&gt;Rewriting the whole app from scratch would be risky and expensive.
Also, Pinterest did not want to freeze code and stop shipping new features.
So they had to migrate a service that is constantly changing. 
A very complicated challenge Imad compares to changing the engines of an airplane while mid-flight.&lt;/p&gt;

&lt;p&gt;The solution was to rewrite the app piece by piece. 
That resulted in creating a so called hybrid app where two frameworks can exist together for the time it takes to migrate from the old framework to the new one.&lt;/p&gt;

&lt;p&gt;The very first step they had to take to make this hybrid app was to change their infrastructure and enable server-side JavaScript rendering.
Before they used the &lt;em&gt;Jinja&lt;/em&gt; templating engine for server-side rendering in Python and the JavaScript equivalent &lt;em&gt;Nunjucks&lt;/em&gt; for client-side rendering.
By also enabling Nunjucks rendering on a stand-alone NodeJS server, they now achieved pure isomorphic rendering with JavaScript on the server and on the client.&lt;/p&gt;

&lt;p&gt;Secondly, Pinterest had to render React components in their old Denzel framework. 
So they added React-specific bindings to Nunjucks’ templating language with a new keyword (component), to represent the “bridge” between Denzel and React.&lt;/p&gt;

&lt;p&gt;An example of a Nunjucks template with a React-Denzel bridge:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;{% if in_react %}
  {{ component('MyReactComponent', {pinId: '123'}) }}
{% else %}
  {{ module('MyDenzelComponent', pinId='123') }}
{% endif %}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Lastly, they had to create adapters for the old data resources. 
To do so, they used a technique called High-Order Components (HOC).
A HOC is a function that takes a component and returns another component.&lt;/p&gt;

&lt;p&gt;This technique allowed them to compose components with a resource.
When the component is added to the DOM, it will create the resource and send a request to the API.
A callback function will update its state and trigger the rendering of the given component. 
With this approach, you can keep your components and data in sync all the time.&lt;/p&gt;

&lt;p&gt;You can read more about HOCs &lt;a href=&quot;https://reactjs.org/docs/higher-order-components.html&quot;&gt;here&lt;/a&gt;&lt;/p&gt;

&lt;h5 id=&quot;ui-experiments&quot;&gt;UI experiments&lt;/h5&gt;
&lt;p&gt;Imad explained that they used an A/B testing framework to measure the impact of the migration.
By doing this they managed to see consistent performance and engagement improvements, both of these metrics have improved by 20 percent.&lt;/p&gt;

&lt;p&gt;Last but not least, migrating to React was also great for the developers: less duplicated code, 
a single language on client and server and a large developer community Imad was definitely happy to be a part of.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;laura-carvajal-yes-your-site-can-and-should-be-accessible-too-lessons-learned-in-building-ftcom&quot;&gt;Laura Carvajal: YES, your site can (and should) be accessible too. Lessons learned in building FT.com&lt;/h3&gt;

&lt;p&gt;&lt;span class=&quot;image left&quot;&gt;&lt;img class=&quot;p-image&quot; alt=&quot;Laura Carvajal&quot; src=&quot;/img/js-conf-budapest-2017/speaker-laura.jpg&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;You can find Laura on Twitter using the handle &lt;a href=&quot;https://twitter.com/lc512k&quot;&gt;@lc512k&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The presentation can be found &lt;a href=&quot;https://speakerdeck.com/lc512k/yes-your-site-can-and-should-be-accessible&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
Laura Carvajali works at the Financial Times. 
She's responsible for the accessibility of their website so that even blind people are able to use it.
In her talk, she explained how to achieve this.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Accessibility doesn’t happen by accident, you have to make it happen yourself.
A good starting point is to install pa11y (with npm).
It checks your HTML and points out where you can improve.
Color contrast issues, no or bad alt text for images and no related label for input fields are very common issues pa11y reports on.
Pa11y-ci can be used to integrate it with your CI and can break the build when there are errors.&lt;/p&gt;

&lt;p&gt;Next, there are some extra steps that can be taken.
The most expensive one is getting an external audit to get more feedback.
They have people that test with voice control, keyboard only mode, text to speech and other tools.
A cheaper option is to do customer research and user testing with users with various disabilities.
Instead of having other people doing the testing, you could learn how to use the tools for people with disabilities yourself.
This is of course the cheapest option.
A MacBook for example already has a lot of tools built in for people with disabilities!&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;day-2-afternoon&quot;&gt;Day 2 afternoon&lt;/h2&gt;

&lt;h3 id=&quot;nikita-baksalyar-exploring-the-p2p-world-with-webrtc--javascript&quot;&gt;Nikita Baksalyar: Exploring the P2P world with WebRTC &amp;amp; JavaScript&lt;/h3&gt;

&lt;p&gt;&lt;span class=&quot;image left&quot;&gt;&lt;img class=&quot;p-image&quot; alt=&quot;Nikita Baksalyar&quot; src=&quot;/img/js-conf-budapest-2017/speaker-nikita.jpg&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;You can find Nikita on Twitter using the handle &lt;a href=&quot;https://twitter.com/nbaksalyar&quot;&gt;@nbaksalyar&lt;/a&gt;.
A similar presentation as the one given at JSConf can be found &lt;a href=&quot;https://www.slideshare.net/nbaksalyar/exploring-decentralized-networks-with-webrtc&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
Nikita Baksalyar is a Software Engineer at MaidSafe. During his talk he explained how we could use newer and not so new technologies to decentralize the web to its former state.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The web becomes increasingly centralized. We trust our private data to be stored in data centers despite news about data leaks. We exchange our messages and they are handled to three-letter agencies without you knowing about it. Can we do better and return the web to its decentralized roots? A combination of proven and emerging technologies like WebRTC can help us.&lt;/p&gt;

&lt;h5 id=&quot;what-is-webrtc&quot;&gt;What is WebRTC?&lt;/h5&gt;

&lt;p&gt;Whenever you visit a webpage, you’d typically enter a web address or click a link to view a page. A request is made to the server and that server provides the webpage you’ve requested. The key here is that you make a HTTP request to a locatable server and get a response back.
Let’s say that you want to do a video chat with mom. Mom’s computer is probably not a web-server, so how will she receive my audio and video data? Enter WebRTC.&lt;/p&gt;

&lt;p&gt;WebRTC stands for web real-time communications. It is a very exciting, powerful, and highly disruptive cutting-edge technology and standard. WebRTC leverages a set of plugin-free APIs that can be used in both desktop and mobile browsers and is progressively becoming supported by all major modern browser vendors.&lt;/p&gt;

&lt;p&gt;The primary benefit of WebRTC is real-time peer-to-peer audio and video communication. In order to communicate with another person (i.e., peer) via a web browser, each person’s web browser must agree to begin communication, know how to locate one another and transmit all multimedia communications in real-time.&lt;/p&gt;

&lt;h5 id=&quot;decentralized-networks&quot;&gt;Decentralized networks&lt;/h5&gt;

&lt;p&gt;When you think of networks you immediately start thinking of network providers, hubs and the likes. We are moving away from the initial idea of the internet, which was supposed to be a decentralized network. Now what is a decentralized network? A good example of a decentralized network is BitCoin. Data is shared over multiple nodes and those nodes get updated by sending update events.&lt;/p&gt;

&lt;h4 id=&quot;the-way-forward&quot;&gt;The way forward&lt;/h4&gt;

&lt;p&gt;The Internet started as a way to have data spread across the world to make sure that in case of a disaster, natural or human made, data would be preserved.
Peer 2 Peer communication is key in both a decentralized and the internet of old. We are making moves towards this redecentralization with the power of WebRTC and other more commonly known technologies such as BitTorrent for file sharing, Distributed git for code, etc.&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;vaidehi-joshi-goldilocks-and-the-three-code-reviews&quot;&gt;Vaidehi Joshi: Goldilocks And The Three Code Reviews&lt;/h3&gt;

&lt;p&gt;&lt;span class=&quot;image left&quot;&gt;&lt;img class=&quot;p-image&quot; alt=&quot;Vaidehi Joshi&quot; src=&quot;/img/js-conf-budapest-2017/speaker-vaidehi.jpg&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;You can find Vaidehi on Twitter using the handle &lt;a href=&quot;https://twitter.com/vaidehijoshi&quot;&gt;@vaidehijoshi&lt;/a&gt;.
The presentation can be found &lt;a href=&quot;http://slides.com/vaidehijoshi/better-code-reviews/&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A similar presentation was recorded on RailsConf 2017 and can be found on &lt;a href=&quot;https://www.youtube.com/watch?v=-6EzycFNwzY&quot;&gt;YouTube&lt;/a&gt;.
A detailed write-out of that presentation can be found on &lt;a href=&quot;https://medium.com/@vaidehijoshi/crafting-better-code-reviews-1a5fc00a9312&quot;&gt;Medium&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
The original intent behind code reviews was that they would help us take collective ownership in the creation of our software.
In other words, we’d each be stakeholders in our development process by having a hand in controlling the quality of our products.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;While code reviews are generally understood as being a necessity to catch problems at the “lowest-value” stages (the time at which the least investment has been made and at which the cost to correct the problem is the lowest), Vaidehi Joshi asks whether they actually work and, if not, how can we try to improve upon the process.
Based on Code Complete by Steve McConnell, she identified 3 major formats of code review:&lt;/p&gt;

&lt;h5 id=&quot;1-inspections&quot;&gt;1. Inspections&lt;/h5&gt;

&lt;p&gt;Inspections are longer, deeper code reviews that typically catch about 60% of defects in a program.&lt;/p&gt;

&lt;h5 id=&quot;2-walkthroughs&quot;&gt;2. Walkthroughs&lt;/h5&gt;

&lt;p&gt;A walkthrough is shorter and is usually intended to provide teaching opportunities for senior developers to newer programmers, while giving junior developers the chance to change old methodologies.
Typically, they catch about 20 to 40% of the defects in a program.&lt;/p&gt;

&lt;h5 id=&quot;3-short-code-reviews&quot;&gt;3. Short code reviews&lt;/h5&gt;

&lt;p&gt;Short reviews are faster, but still in-depth. They focus on small changes, including single-line changes, that tend to be the most error-prone.&lt;/p&gt;

&lt;p&gt;McConnell’s research uncovered the following about shorter code review:&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;
An organization that introduced reviews for one-line changes found that its error rate went from 55 percent before reviews to 2 percent afterward.
A telecommunications organization in the late 80’s went from 86 percent correct before reviewing code changes to 99.6 percent afterward.
&lt;/blockquote&gt;

&lt;h4 id=&quot;but-what-do-developers-think-of-code-reviews&quot;&gt;But what do developers think of code reviews?&lt;/h4&gt;

&lt;p&gt;To know this, Vaidehi did a &lt;a href=&quot;https://twitter.com/vaidehijoshi/status/835597499813494788&quot;&gt;survey on Twitter&lt;/a&gt; and got about 500 responses.
The survey had questions with a scale of 1 to 10, where 1 was strongly disagree and 10 was strongly agree.
These are the stats:&lt;/p&gt;

&lt;h5 id=&quot;the-quantitive-data&quot;&gt;The quantitive data&lt;/h5&gt;

&lt;p&gt;The question “Code reviews are beneficial to my team” had a clear answer.
The average score was around 9 for most languages, with the top 3 containing Swift at an average of 9.46, Ruby at an average of 9.19 and JavaScript at an average of 9.1.&lt;/p&gt;
&lt;p class=&quot;image&quot;&gt;&lt;img src=&quot;/img/js-conf-budapest-2017/vaidehi-joshi-beneficial.jpeg&quot; alt=&quot;Code reviews are beneficial to my team&quot; width=&quot;100%&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Another question was “How many pull requests are reviewed”, on which the majority answered that all pull request were reviewed.
However, about 10% of the answers indicated that pull requests where only reviewed when someone was explicitly requested to review.&lt;/p&gt;
&lt;p class=&quot;image&quot;&gt;&lt;img src=&quot;/img/js-conf-budapest-2017/vaidehi-joshi-how-many-pull-request-reviews.jpeg&quot; alt=&quot;How many pull requests are reviewed&quot; width=&quot;100%&quot; /&gt;&lt;/p&gt;

&lt;h5 id=&quot;the-qualitative-data&quot;&gt;The qualitative data&lt;/h5&gt;

&lt;p&gt;So, most developers think code reviews are needed and state that all code is being reviewed.
But what do they think of the quality of code reviews?&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
Ultimately, what seemed to make or break a code review experience depended upon two things: how much energy was spent during the review process and how much substance the review itself had.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;A code review was bad (and left a bad taste in the reviewer’s and reviewee’s mouth) if there wasn’t enough energy spent on the review, or if it lacked substance.
On the other hand, if a code review process was thorough and time was spent reviewing aspects of the code in a substantive way, it left a much more positive impression overall on both the reviewer and the reviewee.&lt;/p&gt;

&lt;h6 id=&quot;energy&quot;&gt;ENERGY&lt;/h6&gt;

&lt;p&gt;On the question “Who all is doing the review and how much time are they spending on it?”, a lot of things could be learned.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;A developer blindly thumbs-up everything or the second or third reviewer is more likely to agree when already seeing an approval.
This makes the code review a formality, which doesn’t carry any weight.&lt;/li&gt;
  &lt;li&gt;A review is performed different depending on who submits.
Seniors get no feedback, while juniors are picked to death.
The reviews are unfair and can break confidence.&lt;/li&gt;
  &lt;li&gt;Commits are too big, which cause long review time, which in turn has a bad effect on future branches/PRs/merges.
Long review times take too much energy, which causes them to be postponed.&lt;/li&gt;
&lt;/ul&gt;

&lt;h6 id=&quot;substance&quot;&gt;SUBSTANCE&lt;/h6&gt;

&lt;p&gt;The question “What exactly is someone saying, doing, or making another person feel while they review their code?” brought these answers.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;An assessor who takes all the feedback for his own account, having a mentality of “see red squiggle, fix red squiggle”.
They just change the code without second thought, as long as it makes the reviewer happy.&lt;/li&gt;
  &lt;li&gt;A reviewer’s comment is not clearly explained.
The reviewee just has to change their code to the reviewers vision.&lt;/li&gt;
  &lt;li&gt;A reviewer is unable to distinguish between stylistic preference and functional difference, which causes nitpicking at syntax.
Multiple reviewers might even have conflicting visions.&lt;/li&gt;
  &lt;li&gt;Words matter, an unkind review might break confidence.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;how-can-one-do-better&quot;&gt;How can one do better?&lt;/h4&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
A bad code review almost made me leave the company. A great code review leaves me feeling better equipped to tackle future projects.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;Use PR templates.
Github provides some default templates for a PR, in which a couple of questions need to be answered short and clearly.&lt;/li&gt;
  &lt;li&gt;Include screenshots/gifs, providing more context on what is changed and why.&lt;/li&gt;
  &lt;li&gt;Use linters to eliminate style and syntax nitpicking.&lt;/li&gt;
  &lt;li&gt;Encapsulating PRs into small packages, aiming for small commits.&lt;/li&gt;
  &lt;li&gt;Assign specific reviewers, so they may provide valuable input and/or teach or learn something.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;but-even-more-important&quot;&gt;But even more important&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Review everyone: it’s a good horse that never stumbles.
A senior developer is not infallible and might even be overconfident.&lt;/li&gt;
  &lt;li&gt;Develop empathy: call out the good stuff, too.
Make people feel less vulnerable, push for a culture that values vulnerability — both in actions and in words.&lt;/li&gt;
  &lt;li&gt;Most importantly, iterate: start a conversation when feeling that the code review flow doesn’t work well.
Give everyone the chance to propose their suggestions.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This survey answer summarized the importance of the last part perfectly:&lt;/p&gt;

&lt;blockquote class=&quot;clear&quot;&gt;&lt;p&gt;
I love code reviews in theory. In practice, they are only as good as the group that’s responsible for conducting them in the right manner.
&lt;/p&gt;&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;afterparty-at-extra-budapest-by-epam&quot;&gt;Afterparty at EXTRA Budapest by EPAM&lt;/h3&gt;

&lt;p&gt;EPAM invited everyone to chill, have some drinks and games at the EXTRA ruinpub after JSConf Budapest. Beer and a selection of soft drinks and juices are on the house.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;after-movie&quot;&gt;After Movie&lt;/h2&gt;
&lt;div class=&quot;responsive-video&quot;&gt;
    &lt;iframe src=&quot;https://www.youtube.com/embed/fysiFabvGnQ&quot; frameborder=&quot;0&quot; gesture=&quot;media&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;got-triggered&quot;&gt;Got triggered?&lt;/h2&gt;

&lt;p&gt;All talks were recorded by the JSconf team. You can view them &lt;a href=&quot;https://www.youtube.com/playlist?list=PL37ZVnwpeshH9ztZfHqvQhF1_Zm4VcCTD&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;a href=&quot;/conference/2018/01/03/JS-Conf-Budapest-day-1.html&quot;&gt;Read our full report on day 1 of JS Conf Budapest 2017 here!&lt;/a&gt;&lt;/p&gt;</content><author><name>{&quot;first_name&quot;=&gt;&quot;Frédéric&quot;, &quot;last_name&quot;=&gt;&quot;Ghijselinck&quot;, &quot;github&quot;=&gt;&quot;fredericghijselinck&quot;, &quot;twitter&quot;=&gt;&quot;f_ghijselinck&quot;, &quot;linkedin&quot;=&gt;&quot;fredericghijselinck&quot;, &quot;permalink&quot;=&gt;&quot;/author/frederic-ghijselinck/&quot;, &quot;avatar&quot;=&gt;&quot;frederic-ghijselinck.jpg&quot;, &quot;title&quot;=&gt;&quot;Competence Lead JavaScript&quot;, &quot;email&quot;=&gt;&quot;frederic.ghijselinck@ordina.be&quot;, &quot;bio&quot;=&gt;&quot;Frédéric is a Senior developer at Ordina Belgium, focussing on Frontend Development with technologies as Angular and TypeScript. Next to frontend development, he continues to maintain his backend development skills using the Spring technology stack. Frédéric is also Competence Lead for the JavaScript Competence Center where he gives workshops, talks and courses about the newest technologies.&quot;}</name><email>frederic.ghijselinck@ordina.be</email></author><category term="Conference" /><category term="JS Conf Budapest" /><category term="JavaScript" /><category term="Conference" /><summary type="html">From JSConf Budapest with love</summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://ordina-jworks.github.io/img/js-conf-budapest-2017/header.png" /></entry></feed>